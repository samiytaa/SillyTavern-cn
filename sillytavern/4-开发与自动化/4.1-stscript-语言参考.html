<!DOCTYPE html> <html><head>
		<title>4.1 STscript 语言参考</title>
		<base href="..\../">
		<meta id="root-path" root-path="..\../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="SillyTavern - 4.1 STscript 语言参考">
		<meta property="og:title" content="4.1 STscript 语言参考">
		<meta property="og:description" content="SillyTavern - 4.1 STscript 语言参考">
		<meta property="og:type" content="website">
		<meta property="og:url" content="https://samiytaa.github.io/sillytavern/4-开发与自动化/4.1-stscript-语言参考.html">
		<meta property="og:image" content="https://samiytaa.github.io/lib/media/20241222161559033.png">
		<meta property="og:site_name" content="SillyTavern">
		<meta name="author" content="samiytaa"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.ico"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-light show-inline-title show-ribbon"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><pre class="frontmatter language-yaml" tabindex="0" style="display: none;"><code class="language-yaml is-loaded"><span class="token key atrule">title</span><span class="token punctuation">:</span> STscript 语言参考</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="STscript 语言参考">STscript 语言参考</h1><div class="el-h1 heading-wrapper"><div class="heading-children"></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="什么是 STscript？" dir="auto" class="heading" id="什么是_STscript？">什么是 STscript？</h1><div class="heading-children"><div class="el-p"><p dir="auto">STscript 是一种简单而强大的脚本语言，可用于扩展 SillyTavern 的功能，而无需深入的编码知识，使您能够：</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">创建迷你游戏或极速挑战</li>
<li data-line="1" dir="auto">构建 AI 驱动的聊天洞察</li>
<li data-line="2" dir="auto">释放您的创意并与他人分享<br>
STscript 基于斜杠命令引擎，利用命令批处理、数据管道、宏和变量。这些概念将在以下文档中详细介绍。</li>
</ul></div><div class="el-blockquote"><blockquote dir="auto">
<p>STscript 仍在积极开发中。 如果您计划使用其功能，建议使用 staging 分支。</p>
</blockquote></div><div class="el-h2 heading-wrapper"><h2 data-heading="安全预防" dir="auto" class="heading" id="安全预防"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>安全预防</h2><div class="heading-children"><div class="el-p"><p dir="auto">强大的功能伴随着巨大的责任。请小心使用，并在执行脚本前仔细检查其内容。</p></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="Hello, World!" dir="auto" class="heading" id="Hello,_World!">Hello, World!</h1><div class="heading-children"><div class="el-p"><p dir="auto">要运行您的第一个脚本，打开任何 SillyTavern 聊天框并在输入框中键入以下内容：</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/pass Hello, World! | /echo
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"></p><div alt="hello-world" src="lib/media/20241222161559033.png" class="internal-embed media-embed image-embed is-loaded"><img alt="hello-world" src="lib/media/20241222161559033.png"></div><p dir="auto"></p></div><div class="el-p"><p dir="auto">您应该会看到顶部通知栏显示消息。现在让我们逐步分析这个脚本。</p></div><div class="el-p"><p dir="auto">一个脚本是由一组命令组成的，每个命令都以斜杠开头，可能包含命名和未命名的参数，并以命令分隔符字符</p></div><div class="el-p"><p dir="auto"><code>|</code> 结束。</p></div><div class="el-p"><p dir="auto">命令按顺序执行，彼此之间传递数据。</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/pass</code> 命令接受一个常量值 "Hello, World!" 作为未命名参数并将其写入管道。</li>
<li data-line="1" dir="auto"><code>/echo</code> 命令接收来自前一个命令的值并将其作为通知显示。</li>
</ol></div><div class="el-blockquote"><blockquote dir="auto">
<p>提示： 要查看所有可用命令的列表，请在聊天框中输入 /help slash。<br>
由于常量未命名参数和管道是可以互换的，我们可以简化这个脚本：</p>
</blockquote></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo Hello, World!
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="用户输入" dir="auto" class="heading" id="用户输入">用户输入</h1><div class="heading-children"><div class="el-p"><p dir="auto">现在让我们给脚本添加一些互动性。我们将从用户那里接受输入值并显示在通知中。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/input Enter your name |
/echo Hello, my name is {{pipe}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/input</code> 命令用于显示一个输入框，显示提示词（prompt）作为未命名参数，并将用户输入的值写入管道。</li>
<li data-line="1" dir="auto">因为 <code>/echo</code> 已经有一个未命名参数来设置输出模板，我们使用 <code>{{pipe}}</code> 宏来指定一个地方，将管道中的值渲染到这里。</li>
</ol></div><div class="el-p"><p dir="auto"></p><div alt="slim-input" src="lib/media/20241222161559034.png" class="internal-embed media-embed image-embed is-loaded"><img alt="slim-input" src="lib/media/20241222161559034.png"></div><p dir="auto"></p></div><div class="el-p"><p dir="auto"></p><div alt="slim-output" src="lib/media/20241222161559035.png" class="internal-embed media-embed image-embed is-loaded"><img alt="slim-output" src="lib/media/20241222161559035.png"></div><p dir="auto"></p></div><div class="el-h2 heading-wrapper"><h2 data-heading="其他输入/输出命令" dir="auto" class="heading" id="其他输入/输出命令"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>其他输入/输出命令</h2><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>/popup (text)</code> — 显示一个阻塞弹出框，支持轻量 HTML 格式化，例如：<code>/popup &lt;font color=red&gt;I'm red!&lt;/font&gt;</code>。</li>
<li data-line="1" dir="auto"><code>/setinput (text)</code> — 替换用户输入框中的内容为提供的文本。</li>
<li data-line="2" dir="auto"><code>/speak voice="name" (text)</code> — 使用所选的 TTS 引擎并通过角色语音播放文本，例如：<code>/speak name="Donald Duck" Quack!</code>。</li>
<li data-line="3" dir="auto"><code>/buttons labels=["a","b"] (text)</code> — 显示一个阻塞弹出框，带有指定的文本和按钮标签。<code>labels</code> 必须是一个 JSON 格式的字符串数组或包含此数组的变量名。返回被点击的按钮标签，或者如果取消则返回空字符串。文本支持轻量 HTML 格式化。</li>
</ul></div><div class="el-h3 heading-wrapper"><h3 data-heading="`/popup` 和 `/input` 的额外参数" dir="auto" class="heading" id="`/popup`_和_`/input`_的额外参数"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><code>/popup</code> 和 <code>/input</code> 的额外参数</h3><div class="heading-children"><div class="el-p"><p dir="auto"><code>/popup</code> 和 <code>/input</code> 支持以下额外的命名参数：</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>large=on/off</code> - 增加弹出框的垂直大小，默认：<code>off</code>。</li>
<li data-line="1" dir="auto"><code>wide=on/off</code> - 增加弹出框的水平大小，默认：<code>off</code>。</li>
<li data-line="2" dir="auto"><code>okButton=string</code> - 自定义"确认"按钮的文本，默认：<code>Ok</code>。</li>
<li data-line="3" dir="auto"><code>rows=number</code> - （仅适用于 <code>/input</code>）增加输入框的行数，默认：1。<br>
示例：</li>
</ul></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/popup large=on wide=on okButton="Accept" Please accept our terms and conditions....
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="`/echo` 的参数" dir="auto" class="heading" id="`/echo`_的参数"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><code>/echo</code> 的参数</h3><div class="heading-children"><div class="el-p"><p dir="auto"><code>/echo</code> 支持以下值作为额外的 <code>severity</code> 参数，用于设置显示消息的样式。</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>warning</code></li>
<li data-line="1" dir="auto"><code>error</code></li>
<li data-line="2" dir="auto"><code>info</code>（默认）</li>
<li data-line="3" dir="auto"><code>success</code><br>
示例：</li>
</ul></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo severity=error Something really bad happened.
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="变量" dir="auto" class="heading" id="变量">变量</h1><div class="heading-children"><div class="el-p"><p dir="auto">变量用于在脚本中存储和操作数据，可以通过命令或宏进行操作。变量可以是以下几种类型：</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">本地变量 — 保存于当前聊天的元数据中，仅在该聊天中唯一。</li>
<li data-line="1" dir="auto">全局变量 — 保存于 <code>settings.json</code> 中，存在于整个应用中。</li>
</ul></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/getvar name</code> 或 <code>{{getvar::name}}</code> — 获取本地变量的值。</li>
<li data-line="1" dir="auto"><code>/setvar key=name value</code> 或 <code>{{setvar::name::value}}</code> — 设置本地变量的值。</li>
<li data-line="2" dir="auto"><code>/addvar key=name increment</code> 或 <code>{{addvar::name::increment}}</code> — 将 <code>increment</code> 的值添加到本地变量。</li>
<li data-line="3" dir="auto"><code>/incvar name</code> 或 <code>{{incvar::name}}</code> — 将本地变量的值增加 1。</li>
<li data-line="4" dir="auto"><code>/decvar name</code> 或 <code>{{decvar::name}}</code> — 将本地变量的值减少 1。</li>
<li data-line="5" dir="auto"><code>/getglobalvar name</code> 或 <code>{{getglobalvar::name}}</code> — 获取全局变量的值。</li>
<li data-line="6" dir="auto"><code>/setglobalvar key=name</code> 或 <code>{{setglobalvar::name::value}}</code> — 设置全局变量的值。</li>
<li data-line="7" dir="auto"><code>/addglobalvar key=name</code> 或 <code>{{addglobalvar::name:increment}}</code> — 将 <code>increment</code> 的值添加到全局变量。</li>
<li data-line="8" dir="auto"><code>/incglobalvar name</code> 或 <code>{{incglobalvar::name}}</code> — 将全局变量的值增加 1。</li>
<li data-line="9" dir="auto"><code>/decglobalvar name</code> 或 <code>{{decglobalvar::name}}</code> — 将全局变量的值减少 1。</li>
<li data-line="10" dir="auto"><code>/flushvar name</code> — 删除本地变量的值。</li>
<li data-line="11" dir="auto"><code>/flushglobalvar name</code> — 删除全局变量的值。</li>
</ol></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">初次使用时，未定义的变量的默认值为一个空字符串或零（如果是 <code>/addvar</code>、<code>/incvar</code>、<code>/decvar</code> 命令的参数）。</li>
<li data-line="1" dir="auto"><code>/addvar</code> 命令中的增量操作如果能够将增量和变量值转换为数字，则执行加法或减法运算，否则执行字符串连接。</li>
<li data-line="2" dir="auto">如果命令参数接受变量名，并且存在同名的本地和全局变量，则优先使用 <em>本地变量</em>。</li>
<li data-line="3" dir="auto">所有的 <em>斜杠命令</em> 会将结果值写入管道，以便后续命令使用。</li>
<li data-line="4" dir="auto">对于 <em>宏</em>，只有 "get"、"inc" 和 "dec" 类型的宏会返回值，"add" 和 "set" 会被替换为空字符串。<br>
现在，考虑以下示例：</li>
</ul></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/input What do you want to generate? |
/setvar key=SDinput |
/echo Requesting an image of {{getvar::SDinput}} |
/getvar SDinput |
/imagine
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">用户的输入值被保存在本地变量 <code>SDinput</code> 中。</li>
<li data-line="1" dir="auto"><code>getvar</code> 宏被用来在 <code>/echo</code> 命令中显示这个值。</li>
<li data-line="2" dir="auto"><code>getvar</code> 命令用来获取变量的值，并将其传递给下一个命令。</li>
<li data-line="3" dir="auto">这个值被传递给 <code>/imagine</code> 命令（图像生成插件），作为输入提示词（prompt）。<br>
由于变量在脚本执行期间被保存，并且不会在执行间被清除，您可以在其他脚本中引用该变量，它将解析为脚本执行时的相同值。如果要确保值会被丢弃，可以在脚本中添加<br>
<code>/flushvar</code> 命令。</li>
</ol></div><div class="el-h2 heading-wrapper"><h2 data-heading="数组和对象" dir="auto" class="heading" id="数组和对象"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>数组和对象</h2><div class="heading-children"><div class="el-p"><p dir="auto">变量值可以包含 JSON 格式化的数组或键值对对象。</p></div><div class="el-p"><p dir="auto">示例：</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">
<p>数组：<code>["apple","banana","orange"]</code></p>
</li>
<li data-line="1" dir="auto">
<p>对象：<code>{"fruits":["apple","banana","orange"]}</code><br>
可以对命令进行以下修改，以便操作这些类型的变量：</p>
</li>
<li data-line="4" dir="auto">
<p><code>/len</code> 命令获取数组的元素数量。</p>
</li>
<li data-line="5" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>
<p>可以在 <code>/getvar</code> 或 <code>/setvar</code> 命令中使用 <code>index=number/string</code> 作为命名参数来获取或设置数组的子值，或获取对象的键值。</p>
<ul>
<li data-line="6" dir="auto">如果数组变量使用数字索引且该索引不存在，变量会被创建为一个空数组 <code>[]</code>。</li>
<li data-line="7" dir="auto">如果对象变量使用字符串索引且该索引不存在，变量会被创建为一个空对象 <code>{}</code>。</li>
</ul>
</li>
<li data-line="8" dir="auto">
<p><code>/addvar</code> 和 <code>/addglobalvar</code> 命令支持将新值推送到数组类型的变量。</p>
</li>
</ul></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="流程控制 - 条件语句" dir="auto" class="heading" id="流程控制_-_条件语句">流程控制 - 条件语句</h1><div class="heading-children"><div class="el-p"><p dir="auto">您可以使用 <code>/if</code> 命令创建条件表达式，根据定义的规则分支执行。</p></div><div class="el-p"><p dir="auto"><code>/if left=valueA right=valueB rule=comparison else="(false command)" "(true command)"</code></p></div><div class="el-p"><p dir="auto">我们来看看以下示例：</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/input What's your favorite drink? |
/if left={{pipe}} right="black tea" rule=eq else="/echo You shall not pass \\\\\\\\| /abort" "/echo Welcome to the club, \\\\\\\\{\\\\\\\\{user\\\\\\\\}\\\\\\\\}"
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">这个脚本根据用户输入的值判断并显示不同的消息。</p></div><div class="el-h2 heading-wrapper"><h2 data-heading="`/if` 参数" dir="auto" class="heading" id="`/if`_参数"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><code>/if</code> 参数</h2><div class="heading-children"><div class="el-ol"><ol>
<li data-line="0" dir="auto">
<p><code>left</code> 是第一个操作数，我们称其为 A。</p>
</li>
<li data-line="1" dir="auto">
<p><code>right</code> 是第二个操作数，我们称其为 B。</p>
</li>
<li data-line="2" dir="auto">
<p><code>rule</code> 是应用于操作数的运算符。</p>
</li>
<li data-line="3" dir="auto">
<p><code>else</code> 是可选的字符串，表示如果布尔比较结果为假时执行的子命令。</p>
</li>
<li data-line="4" dir="auto">
<p>未命名的参数是布尔比较结果为真时执行的子命令。<br>
操作数值的评估顺序如下：</p>
</li>
<li data-line="7" dir="auto">
<p>数字字面量</p>
</li>
<li data-line="8" dir="auto">
<p>本地变量名</p>
</li>
<li data-line="9" dir="auto">
<p>全局变量名</p>
</li>
<li data-line="10" dir="auto">
<p>字符串字面量<br>
命名参数的字符串可以用引号转义，以允许多单词字符串，转义后的引号会被丢弃。</p>
</li>
</ol></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="布尔运算" dir="auto" class="heading" id="布尔运算"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>布尔运算</h2><div class="heading-children"><div class="el-p"><p dir="auto">支持以下布尔比较规则，操作结果为布尔值（真或假）：</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>eq</code>（等于）=&gt; A = B</li>
<li data-line="1" dir="auto"><code>neq</code>（不等于）=&gt; A != B</li>
<li data-line="2" dir="auto"><code>lt</code>（小于）=&gt; A &lt; B</li>
<li data-line="3" dir="auto"><code>gt</code>（大于）=&gt; A &gt; B</li>
<li data-line="4" dir="auto"><code>lte</code>（小于或等于）=&gt; A &lt;= B</li>
<li data-line="5" dir="auto"><code>gte</code>（大于或等于）=&gt; A &gt;= B</li>
<li data-line="6" dir="auto"><code>not</code>（否定）=&gt; !A</li>
<li data-line="7" dir="auto"><code>in</code>（包含子字符串）=&gt; A 包含 B，忽略大小写</li>
<li data-line="8" dir="auto"><code>nin</code>（不包含子字符串）=&gt; A 不包含 B，忽略大小写</li>
</ol></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="子命令" dir="auto" class="heading" id="子命令"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>子命令</h2><div class="heading-children"><div class="el-p"><p dir="auto">子命令是一个包含多个斜杠命令的字符串。</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">
<p>为了在子命令中使用命令批处理，命令分隔符字符应转义（见下文）。</p>
</li>
<li data-line="1" dir="auto">
<p>由于宏值在条件进入时被执行，而不是在子命令执行时，因此可以转义宏，以延迟它们的执行时间。</p>
</li>
<li data-line="2" dir="auto">
<p>子命令执行的结果将被传递给 <code>/if</code> 后的命令。</p>
</li>
<li data-line="3" dir="auto">
<p><code>/abort</code> 命令会中止脚本执行。</p>
<p><code>/if</code> 命令也可以作为三元运算符使用。以下示例将在变量 <code>a</code> 等于 5 时，将 "true" 字符串传递给下一个命令，否则传递 "false" 字符串。</p>
</li>
</ol></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/if left=a right=5 rule=eq else="/pass false" "/pass true" |
/echo
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="转义序列" dir="auto" class="heading" id="转义序列">转义序列</h1><div class="heading-children"><div class="el-h2 heading-wrapper"><h2 data-heading="宏" dir="auto" class="heading" id="宏"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>宏</h2><div class="heading-children"><div class="el-p"><p dir="auto">宏的转义方法与以前一样。不过，在使用闭包时，通常需要转义宏的次数会少得多。你只需转义两个大括号的开头，或者同时转义开头和结尾的大括号对。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo \\\\\\\\{\\\\\\\\{char}} |
/echo \\\\\\\\{\\\\\\\\{char\\\\\\\\}\\\\\\\\}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="管道符" dir="auto" class="heading" id="管道符"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>管道符</h2><div class="heading-children"><div class="el-p"><p dir="auto">在闭包中，管道符不需要转义（当用作命令分隔符时）。在其他地方，如果你希望使用字面量管道符而不是命令分隔符，必须进行转义。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo title="a\\\\\\\\|b" c\\\\\\\\|d |
/echo title=a\\\\\\\\|b c\\\\\\\\|d |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">启用解析器标志 <code>STRICT_ESCAPING</code> 后，你不需要在引号值中转义管道符。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/parser-flag STRICT_ESCAPING |
/echo title="a|b" c\\\\\\\\|d |
/echo title=a\\\\\\\\|b c\\\\\\\\|d |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="引号" dir="auto" class="heading" id="引号"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>引号</h2><div class="heading-children"><div class="el-p"><p dir="auto">要在引号值内使用字面量的引号字符，必须进行转义。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo title="a \\\\\\\\"b\\\\\\\\" c" d "e" f
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="空格" dir="auto" class="heading" id="空格"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>空格</h2><div class="heading-children"><div class="el-p"><p dir="auto">要在命名参数的值中使用空格，你必须用引号将值括起来，或者转义空格字符。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo title="a b" c d |
/echo title=a\\\\\\\\ b c d
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="闭包定界符" dir="auto" class="heading" id="闭包定界符"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>闭包定界符</h2><div class="heading-children"><div class="el-p"><p dir="auto">如果你想使用标记闭包开始或结束的字符组合，则需要用一个反斜杠转义该序列。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo \\\\\\\\{: |
/echo \\\\\\\\:}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="管道断开符" dir="auto" class="heading" id="管道断开符">管道断开符</h1><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">||
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">为了防止前一个命令的输出自动作为未命名参数传递给下一个命令，可以在两个命令之间放置双管道符。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo we don't want to pass this on ||
/world
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="闭包" dir="auto" class="heading" id="闭包">闭包</h1><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">{: ... :}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">闭包（块语句、匿名函数、匿名函数等的说法）是一系列命令，它们被包裹在 <code>{:</code> 和 <code>:}</code> 之间，只有在执行该部分代码时才会被评估。</p></div><div class="el-h2 heading-wrapper"><h2 data-heading="子命令" dir="auto" class="heading" id="子命令"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>子命令</h2><div class="heading-children"><div class="el-p"><p dir="auto">闭包使得使用子命令变得更加容易，且不再需要转义管道符和宏。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">// 没有闭包的 if |
/if left=1 rule=eq right=1
    else="
        /echo not equal \\\\\\\\|
        /return 0
    "
    /echo equal \\\\\\\\|
    /return \\\\\\\\{\\\\\\\\{pipe\\\\\\\\}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">// 有闭包的 if |
/if left=1 rule=eq right=1
    else={:
        /echo not equal |
        /return 0
    :}
    {:
        /echo equal |
        /return {{pipe}}
    :}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="作用域" dir="auto" class="heading" id="作用域"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>作用域</h2><div class="heading-children"><div class="el-p"><p dir="auto">闭包有自己的作用域，并且支持作用域变量。作用域变量通过 <code>/let</code> 声明，使用 <code>/var</code> 设置和获取其值。另一种获取作用域变量的方法是使用 <code>{{var::}}</code> 宏。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let x |
/let y 2 |
/var x 1 |
/var y |
/echo x is {{var::x}} and y is {{pipe}}.
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">在闭包内，你可以访问该闭包内或其父闭包中声明的所有变量。你不能访问闭包后代中声明的变量。</p></div><div class="el-p"><p dir="auto">如果在闭包中声明了与父闭包中同名的变量，你将无法访问父闭包中的变量。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let x this is root x |
/let y this is root y |
/return {:
    /echo called from level-1: x is "{{var::x}}" and y is "{{var::y}}" |
    /delay 500 |
    /let x this is level-1 x |
    /echo called from level-1: x is "{{var::x}}" and y is "{{var::y}}" |
    /delay 500 |
    /return {:
        /echo called from level-2: x is "{{var::x}}" and y is "{{var::y}}" |
        /let x this is level-2 x |
        /echo called from level-2: x is "{{var::x}}" and y is "{{var::y}}" |
        /delay 500
    :}()
:}() |
/echo called from root: x is "{{var::x}}" and y is "{{var::y}}"
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="命名闭包" dir="auto" class="heading" id="命名闭包"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>命名闭包</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let x {: ... :} | /:x
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">闭包可以被分配给变量（仅限作用域变量），以便稍后调用或作为子命令使用。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let myClosure {:
    /echo this is my closure
:} |
/:myClosure
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let myClosure {:
    /echo this is my closure |
    /delay 500
:} |
/times 3 {{var::myClosure}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><code>/:</code> 也可以用来执行快速回复，它是 <code>/run</code> 的快捷方式。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/:QrSetName.QrButtonLabel |
/run QrSetName.QrButtonLabel
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="闭包参数" dir="auto" class="heading" id="闭包参数"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>闭包参数</h2><div class="heading-children"><div class="el-p"><p dir="auto">命名闭包可以像斜杠命令一样接受命名参数，参数可以有默认值。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let myClosure {: a=1 b=
    /echo a is {{var::a}} and b is {{var::b}}
:} |
/:myClosure b=10
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="闭包和管道参数" dir="auto" class="heading" id="闭包和管道参数"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>闭包和管道参数</h2><div class="heading-children"><div class="el-p"><p dir="auto">父闭包的管道值不会自动注入到子闭包的第一个命令的未命名参数中。</p></div><div class="el-p"><p dir="auto">你仍然可以通过</p></div><div class="el-p"><p dir="auto"><code>{{pipe}}</code> 显式引用父闭包的管道值，但如果你让子闭包的第一个命令的未命名参数为空值，管道值不会自动注入。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/* 以前这会尝试将模型改为 "foo"，因为外部 /echo 的值 "foo"
   被注入到了内部 /model 命令。
   现在它只是简单地回显当前模型，而不尝试修改它。
*|
/echo foo |
/times 2 {:
	/model |
	/echo |
:} |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/* 你仍然可以通过显式使用 {{pipe}} 宏来恢复以前的行为。
*|
/echo foo |
/times 2 {:
	/model {{pipe}} |
	/echo |
:} |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="立即执行闭包" dir="auto" class="heading" id="立即执行闭包"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>立即执行闭包</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">{: ... :}()
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">闭包可以立即执行，意味着它们会被替换为返回值。这对于在没有显式支持闭包的地方非常有用，或者可以缩短一些需要多个中间变量的命令。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">// 没有闭包的简单长度比较 |
/len foo |
/var lenOfFoo {{pipe}} |
/len bar |
/var lenOfBar {{pipe}} |
/if left={{var::lenOfFoo}} rule=eq right={{var:lenOfBar}} /echo yay!
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">// 使用立即执行闭包进行相同的比较 |
/if left={:/len foo:}() rule=eq right={:/len bar:}() /echo yay!
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">除了运行保存在作用域变量中的命名闭包外，<code>/run</code> 命令也可以用来立即执行闭包。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/run {:
	/add 1 2 3 4 |
:} |
/echo |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="注释" dir="auto" class="heading" id="注释">注释</h1><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">// ... | /# ...
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">注释是对脚本代码的可读说明或注解，注释不会中断管道。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">// this is a comment |
/echo foo |
/# this is also a comment
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2 heading-wrapper"><h2 data-heading="块注释" dir="auto" class="heading" id="块注释"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>块注释</h2><div class="heading-children"><div class="el-p"><p dir="auto">块注释可用于快速注释掉多条命令。它们不会终止管道。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo foo |
/*
/echo bar |
/echo foobar |
*|
/echo foo again |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="流程控制" dir="auto" class="heading" id="流程控制">流程控制</h1><div class="heading-children"><div class="el-h2 heading-wrapper"><h2 data-heading="循环：`/while` 和 `/times`" dir="auto" class="heading" id="循环：`/while`_和_`/times`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>循环：<code>/while</code> 和 <code>/times</code></h2><div class="heading-children"><div class="el-p"><p dir="auto">如果你需要在某个条件满足时运行一些命令，可以使用 <code>/while</code> 命令。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/while left=valueA right=valueB rule=operation guard=on "commands"
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">每一步，循环都会比较变量 A 和变量 B 的值，如果条件为真，则执行被引号括起来的任何有效斜杠命令，否则退出循环。该命令不会写入输出管道。</p></div><div class="el-h3 heading-wrapper"><h3 data-heading="`/while` 的参数" dir="auto" class="heading" id="`/while`_的参数"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><code>/while</code> 的参数</h3><div class="heading-children"><div class="el-p"><p dir="auto"><strong>可用的布尔比较、变量处理、字面值和子命令集与</strong> <code>**/if**</code> <strong>命令相同。</strong><br>
可选的<br>
<code>guard</code> 命名参数（默认为 <code>on</code>）用于防止死循环，将迭代次数限制为 100 次。要禁用并允许死循环，请设置 <code>guard=off</code><br>
。<br>
该示例将 1 加到<br>
<code>i</code> 的值，直到其达到 10，然后输出结果值（在本例中为 10）。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/setvar key=i 0 |
/while left=i right=10 rule=lt "/addvar key=i 1" |
/echo {{getvar::i}} |
/flushvar i
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="`/times` 的参数" dir="auto" class="heading" id="`/times`_的参数"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><code>/times</code> 的参数</h3><div class="heading-children"><div class="el-p"><p dir="auto">该命令会重复指定的子命令若干次。</p></div><div class="el-p"><p dir="auto"><code>/times (repeats) "(command)"</code> —— 任何有效的斜杠命令将重复若干次，例如 <code>/setvar key=i 1 | /times 5 "/addvar key=i 1"</code> 将 <code>i</code> 增加 1 5 次。</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>{{timesIndex}}</code> 会被替换为迭代次数（从零开始），例如 <code>/times 4 "/echo {{timesIndex}}"</code> 会依次回显数字 0 到 4。</li>
<li data-line="1" dir="auto">循环默认最多执行 100 次，传递 <code>guard=off</code> 可禁用此限制。</li>
</ul></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="跳出循环和闭包" dir="auto" class="heading" id="跳出循环和闭包"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>跳出循环和闭包</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/break |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><code>/break</code> 命令可用于提前跳出循环（<code>/while</code> 或 <code>/times</code>）或闭包。<code>/break</code> 的未命名参数可以用于传递不同于当前管道的值。</p></div><div class="el-p"><p dir="auto"><code>/break</code> 目前在以下命令中实现：</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>/while</code> - 提前退出循环</li>
<li data-line="1" dir="auto"><code>/times</code> - 提前退出循环</li>
<li data-line="2" dir="auto"><code>/run</code>（带闭包或通过变量的闭包） - 提前退出闭包</li>
<li data-line="3" dir="auto"><code>/:</code>（带闭包） - 提前退出闭包</li>
</ul></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/times 10 {:
	/echo {{timesIndex}}
	/delay 500 |
	/if left={{timesIndex}} rule=gt right=3 {:
		/break
	:} |
:} |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let x {: iterations=2
	/if left={{var::iterations}} rule=gt right=10 {:
		/break too many iterations! |
	:} |
	/times {{var::iterations}} {:
		/delay 500 |
		/echo {{timesIndex}} |
	:} |
:} |
/:x iterations=30 |
/echo the final result is: {{pipe}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/run {:
	/break 1 |
	/pass 2 |
:} |
/echo pipe will be one: {{pipe}} |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let x {:
	/break 1 |
	/pass 2 |
:} |
/:x |
/echo pipe will be one: {{pipe}} |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="数学运算" dir="auto" class="heading" id="数学运算">数学运算</h1><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">以下所有操作都接受一系列数字或变量名并将结果输出到管道。</li>
<li data-line="1" dir="auto">无效操作（如除以零）以及导致 NaN 值或无穷大的运算返回零。</li>
<li data-line="2" dir="auto">乘法、加法、最小值和最大值可以接受多个参数，参数之间用空格分隔。</li>
<li data-line="3" dir="auto">减法、除法、指数和取余操作仅接受两个参数，参数之间用空格分隔。</li>
<li data-line="4" dir="auto">正弦、余弦、自然对数、平方根、绝对值和四舍五入操作仅接受一个参数。<br>
<strong>操作列表：</strong></li>
</ul></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/add (a b c d)</code> – 对一组值进行加法运算，例如 <code>/add 10 i 30 j</code></li>
<li data-line="1" dir="auto"><code>/mul (a b c d)</code> – 对一组值进行乘法运算，例如 <code>/mul 10 i 30 j</code></li>
<li data-line="2" dir="auto"><code>/max (a b c d)</code> – 返回一组值中的最大值，例如 <code>/max 1 0 4 k</code></li>
<li data-line="3" dir="auto"><code>/min (a b c d)</code> – 返回一组值中的最小值，例如 <code>/min 5 4 i 2</code></li>
<li data-line="4" dir="auto"><code>/sub (a b)</code> – 对两个值进行减法运算，例如 <code>/sub i 5</code></li>
<li data-line="5" dir="auto"><code>/div (a b)</code> – 对两个值进行除法运算，例如 <code>/div 10 i</code></li>
<li data-line="6" dir="auto"><code>/mod (a b)</code> – 对两个值进行取余运算，例如 <code>/mod i 2</code></li>
<li data-line="7" dir="auto"><code>/pow (a b)</code> – 对两个值进行指数运算，例如 <code>/pow i 2</code></li>
<li data-line="8" dir="auto"><code>/sin (a)</code> – 对一个值进行正弦运算，例如 <code>/sin i</code></li>
<li data-line="9" dir="auto"><code>/cos (a)</code> – 对一个值进行余弦运算，例如 <code>/cos i</code></li>
<li data-line="10" dir="auto"><code>/log (a)</code> – 对一个值进行自然对数运算，例如 <code>/log i</code></li>
<li data-line="11" dir="auto"><code>/abs (a)</code> – 对一个值进行绝对值运算，例如 <code>/abs -10</code></li>
<li data-line="12" dir="auto"><code>/sqrt (a)</code>– 对一个值进行平方根运算，例如 <code>/sqrt 9</code></li>
<li data-line="13" dir="auto"><code>/round (a)</code> – 对一个值进行四舍五入运算，例如 <code>/round 3.14</code></li>
<li data-line="14" dir="auto"><code>/rand (round=round|ceil|floor from=number=0 to=number=1)</code> – 返回一个在 from 和 to 之间的随机数，例如 <code>/rand</code> 或 <code>/rand 10</code> 或 <code>/rand from=5 to=10</code>。范围是包含端点的。返回的值将包含小数部分。使用<code>round</code>参数可以返回整数值，例如 <code>/rand round=ceil</code> 向上取整，<code>round=floor</code> 向下取整，<code>round=round</code> 四舍五入。</li>
</ol></div><div class="el-h2 heading-wrapper"><h2 data-heading="示例 1：计算半径为 50 的圆的面积。" dir="auto" class="heading" id="示例_1：计算半径为_50_的圆的面积。"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>示例 1：计算半径为 50 的圆的面积。</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/setglobalvar key=PI 3.1415 |
/setvar key=r 50 |
/mul r r PI |
/round |
/echo 圆的面积: {{pipe}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="示例 2：计算 5 的阶乘。" dir="auto" class="heading" id="示例_2：计算_5_的阶乘。"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>示例 2：计算 5 的阶乘。</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/setvar key=input 5 |
/setvar key=i 1 |
/setvar key=product 1 |
/while left=i right=input rule=lte "/mul product i \\\\\\\\| /setvar key=product \\\\\\\\| /addvar key=i 1" |
/getvar product |
/echo {{getvar::input}}的阶乘: {{pipe}} |
/flushvar input |
/flushvar i |
/flushvar product
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="使用 LLM（大语言模型）" dir="auto" class="heading" id="使用_LLM（大语言模型）">使用 LLM（大语言模型）</h1><div class="heading-children"><div class="el-p"><p dir="auto">脚本可以通过以下命令向当前连接的 LLM API 发出请求：</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>/gen (prompt)</code> — 使用提供的提示词生成文本，按照选定角色生成，包括聊天消息。</li>
<li data-line="1" dir="auto"><code>/genraw (prompt)</code> — 使用纯提示词生成文本，忽略当前角色和聊天。</li>
<li data-line="2" dir="auto"><code>/trigger</code> — 触发正常生成（相当于点击“发送”按钮）。如果是群聊，可以选择提供一个 1 基的组员索引或角色名，其他情况下则按群设置触发一次群聊轮次。</li>
</ul></div><div class="el-h2 heading-wrapper"><h2 data-heading="`/gen` 和 `/genraw` 的参数" dir="auto" class="heading" id="`/gen`_和_`/genraw`_的参数"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><code>/gen</code> 和 <code>/genraw</code> 的参数</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/genraw lock=on/off stop=[] instruct=on/off (prompt)
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>lock</code> — 可以设置为 <code>on</code> 或 <code>off</code>。指定在生成进行时是否禁止用户输入。默认：<code>off</code>。</li>
<li data-line="1" dir="auto"><code>stop</code> — JSON 序列化数组的字符串。为此生成提供自定义停止字符串（如果 API 支持）。默认：无。</li>
<li data-line="2" dir="auto"><code>instruct</code>（仅对<code>/genraw</code>有效）— 可以设置为 <code>on</code> 或 <code>off</code>。允许在输入提示词时使用指令格式（如果 API 支持并且启用了指令模式）。设置为<code>off</code>可以强制使用纯提示词。默认：<code>on</code>。</li>
<li data-line="3" dir="auto"><code>as</code>（对于文本补全 API）— 可以设置为 <code>system</code>（默认）或 <code>char</code>。定义最后的提示行格式。<code>char</code>将使用角色名称，<code>system</code>则使用中立格式。<br>
生成的文本将通过管道传递到下一个命令，并可以保存到变量或通过输入输出能力显示：</li>
</ul></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/genraw 写一条来自克苏鲁的幽默信息，谈论征服世界。使用表情符号。 |
/popup &lt;h3&gt;克苏鲁说:&lt;/h3&gt;&lt;div&gt;{{pipe}}&lt;/div&gt;
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"></p><div alt="image 10|image 10.png" src="lib/media/20241222161559036.png" class="internal-embed media-embed image-embed is-loaded"><img alt="image 10|image 10.png" src="lib/media/20241222161559036.png"></div><p dir="auto"></p></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="提示词注入" dir="auto" class="heading" id="提示词注入">提示词注入</h1><div class="heading-children"><div class="el-p"><p dir="auto">脚本可以添加自定义的 LLM 提示词注入，基本相当于无限制的作者注释。</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>/inject (text)</code> — 将任何文本插入到当前聊天的正常 LLM 提示词中，并需要一个唯一的标识符。保存到聊天元数据。</li>
<li data-line="1" dir="auto"><code>/listinjects</code> — 显示当前聊天中由脚本添加的所有提示词注入。</li>
<li data-line="2" dir="auto"><code>/flushinjects</code> — 删除当前聊天中由脚本添加的所有提示词注入。</li>
<li data-line="3" dir="auto"><code>/note (text)</code> — 设置当前聊天的作者注释值。保存到聊天元数据。</li>
<li data-line="4" dir="auto"><code>/interval</code> — 设置当前聊天的作者注释插入间隔。</li>
<li data-line="5" dir="auto"><code>/depth</code> — 设置当前聊天的作者注释插入深度。</li>
<li data-line="6" dir="auto"><code>/position</code> — 设置当前聊天的作者注释插入位置。</li>
</ul></div><div class="el-h2 heading-wrapper"><h2 data-heading="`/inject` 的参数" dir="auto" class="heading" id="`/inject`_的参数"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><code>/inject</code> 的参数</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/inject id=IdGoesHere position=chat depth=4 我的提示词注入
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>id</code> — 一个标识符字符串或变量引用。后续调用相同 ID 的<code>/inject</code>将覆盖之前的文本注入。<strong>必须提供该参数。</strong></li>
<li data-line="1" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><code>position</code> — 设置插入的位置。默认：<code>after</code>。可能的值：
<ul>
<li data-line="2" dir="auto"><code>after</code>：在主提示词之后。</li>
<li data-line="3" dir="auto"><code>before</code>：在主提示词之前。</li>
<li data-line="4" dir="auto"><code>chat</code>：插入到聊天中。</li>
</ul>
</li>
<li data-line="5" dir="auto"><code>depth</code> — 设置插入的深度，0 表示插入到最后一条消息之后，1 表示插入到最后一条消息之前，依此类推。默认：4。</li>
<li data-line="6" dir="auto">未命名的参数是要插入的文本。如果为空字符串，则会删除该标识符之前的值。</li>
</ul></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="访问聊天消息" dir="auto" class="heading" id="访问聊天消息">访问聊天消息</h1><div class="heading-children"><div class="el-h2 heading-wrapper"><h2 data-heading="读取消息" dir="auto" class="heading" id="读取消息"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>读取消息</h2><div class="heading-children"><div class="el-p"><p dir="auto">您可以使用 <code>/messages</code> 命令访问当前选定聊天中的消息。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/messages names=on/off start-finish
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>names</code> 参数用于指定是否希望包含角色名称，默认值：<code>on</code>。</li>
<li data-line="1" dir="auto">未命名参数接受消息索引或范围，格式为 <code>start-finish</code>。范围是包含端点的！</li>
<li data-line="2" dir="auto">如果范围无法满足（例如提供了无效索引或请求的消息数量超出了存在的消息数量），则返回空字符串。</li>
<li data-line="3" dir="auto">隐藏的消息（由鬼魂图标标记）将被排除在输出之外。</li>
<li data-line="4" dir="auto">若要了解最新消息的索引，请使用 <code>{{lastMessageId}}</code>，<code>{{lastMessage}}</code> 将获取最新的消息本身。<br>
要计算范围的起始索引，例如，当您需要获取最后 N 条消息时，可以使用变量减法。 以下示例将获取最近的 3 条消息：</li>
</ul></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/setvar key=start {{lastMessageId}} |
/addvar key=start -2 |
/messages names=off {{getvar::start}}-{{lastMessageId}} |
/setinput
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="发送消息" dir="auto" class="heading" id="发送消息"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>发送消息</h2><div class="heading-children"><div class="el-p"><p dir="auto">脚本可以以用户、角色、人物、或中立叙述者身份发送消息，也可以添加评论。</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">
<p><code>/send (text)</code> — 以当前选定的身份添加一条消息。</p>
</li>
<li data-line="1" dir="auto">
<p><code>/sendas name=charname (text)</code> — 以任何角色的身份添加消息，<code>name</code> 参数是必需的。使用 <code>{{char}}</code> 宏来发送当前角色的消息。</p>
</li>
<li data-line="2" dir="auto">
<p><code>/sys (text)</code> — 以中立叙述者身份添加消息，该消息不属于用户或角色。显示的名称纯粹是装饰性，可以使用 <code>/sysname</code> 命令自定义。</p>
</li>
<li data-line="3" dir="auto">
<p><code>/comment (text)</code> — 添加一条隐藏评论，该评论在聊天中显示，但不会出现在提示词中。</p>
</li>
<li data-line="4" dir="auto">
<p><code>/addswipe (text)</code> — 为最后的角色消息添加一个滑动动作。<br>
不能对用户或隐藏的消息添加滑动动作。 6.<br>
<code>/hide (message id or range)</code> — 根据提供的消息索引或范围（<code>start-finish</code>格式）隐藏一条或多条消息。 7. <code>/unhide (message id or range)</code> — 根据提供的消息索引或范围（<code>start-finish</code>格式）恢复一条或多条消息。</p>
<p><code>/send</code>、<code>/sendas</code>、<code>/sys</code> 和 <code>/comment</code> 命令都可以选择性地接受 <code>at</code> 参数，指定消息插入的确切位置。默认情况下，新的消息会插入到聊天日志的末尾。</p>
<p>以下将用户消息插入到聊天历史的开头：</p>
</li>
</ol></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/send at=0 我使用Linux。
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="删除消息" dir="auto" class="heading" id="删除消息"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>删除消息</h2><div class="heading-children"><div class="el-p"><p dir="auto"><strong>这些命令是潜在的破坏性操作，没有“撤销”功能。请检查</strong> <code>**/backups/**</code> <strong>文件夹，避免误删重要内容。</strong></p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/cut (message id or range)</code> — 根据提供的消息索引或范围（<code>start-finish</code>格式）剪切一条或多条消息。</li>
<li data-line="1" dir="auto"><code>/del (number)</code> — 删除最近的 N 条消息。</li>
<li data-line="2" dir="auto"><code>/delswipe (1-based swipe id)</code> — 根据提供的 1 基索引删除最后一条角色消息中的滑动动作。</li>
<li data-line="3" dir="auto"><code>/delname (character name)</code> — 删除当前聊天中所有属于指定角色的消息。</li>
<li data-line="4" dir="auto"><code>/delchat</code> — 删除当前聊天。</li>
</ol></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="世界书（World Info）命令" dir="auto" class="heading" id="世界书（World_Info）命令">世界书（World Info）命令</h1><div class="heading-children"><div class="el-p"><p dir="auto">世界书（也称为 Lorebook）是一个高度实用的工具，用于动态地将数据插入到提示词（prompt）中。请参见专门的页面以获取更详细的说明：<a data-href="2.7 世界书（World Info）" href="sillytavern/2-使用指南/2.7-世界书（world-info）.html" class="internal-link" target="_self" rel="noopener nofollow">2.7 世界书（World Info）</a>。</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/getchatbook</code> – 获取与当前聊天绑定的世界书文件的名称，如果未绑定，则创建一个新文件，并将其传递给后续命令。</li>
<li data-line="1" dir="auto"><code>/findentry file=bookName field=fieldName [text]</code> – 使用模糊匹配查找指定文件中字段值与提供的文本（默认为<code>key</code>字段）匹配的记录，并将 UID 传递给后续命令。例如：<code>/findentry file=chatLore field=key Shadowfang</code>。</li>
<li data-line="2" dir="auto"><code>/getentryfield file=bookName field=field [UID]</code> – 获取指定世界书文件中指定 UID 的记录的字段值（默认为<code>content</code>字段），并将其传递给后续命令。例如：<code>/getentryfield file={{getvar::chatLore}} field=content 123</code>。</li>
<li data-line="3" dir="auto"><code>/setentryfield file=bookName uid=UID field=field [text]</code> – 设置指定世界书文件中 UID（或指向 UID 的变量）记录的字段值（默认为<code>content</code>字段）。要为关键字段设置多个值，请使用逗号分隔的列表。例如：<code>/setentryfield file=chatLore uid=123 field=key Shadowfang,sword,weapon</code>。</li>
<li data-line="4" dir="auto"><code>/createentry file=bookName key=keyValue [content text]</code> – 在指定文件中创建一条新的记录，并传递 UID（<code>key</code>和<code>content</code>两个参数均为可选）。例如：<code>/createentry file=chatLore key=Shadowfang The sword of the king</code>。</li>
</ol></div><div class="el-h2 heading-wrapper"><h2 data-heading="有效字段" dir="auto" class="heading" id="有效字段"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>有效字段</h2><div class="heading-children"><div class="el-table" dir="ltr" style="overflow-x: auto;"><table>
<thead>
<tr>
<th dir="ltr">字段</th>
<th dir="ltr">UI 元素</th>
<th dir="ltr">值类型</th>
</tr>
</thead>
<tbody>
<tr>
<td dir="ltr"><code>content</code></td>
<td dir="ltr">内容</td>
<td dir="ltr">字符串</td>
</tr>
<tr>
<td dir="ltr"><code>comment</code></td>
<td dir="ltr">标题/备注</td>
<td dir="ltr">字符串</td>
</tr>
<tr>
<td dir="ltr"><code>key</code></td>
<td dir="ltr">主要关键词</td>
<td dir="ltr">字符串列表</td>
</tr>
<tr>
<td dir="ltr"><code>keysecondary</code></td>
<td dir="ltr">可选过滤器</td>
<td dir="ltr">字符串列表</td>
</tr>
<tr>
<td dir="ltr"><code>constant</code></td>
<td dir="ltr">常量状态</td>
<td dir="ltr">布尔值（1/0）</td>
</tr>
<tr>
<td dir="ltr"><code>disable</code></td>
<td dir="ltr">禁用状态</td>
<td dir="ltr">布尔值（1/0）</td>
</tr>
<tr>
<td dir="ltr"><code>order</code></td>
<td dir="ltr">顺序</td>
<td dir="ltr">数字</td>
</tr>
<tr>
<td dir="ltr"><code>selectiveLogic</code></td>
<td dir="ltr">逻辑</td>
<td dir="ltr">（见下文）</td>
</tr>
<tr>
<td dir="ltr"><code>excludeRecursion</code></td>
<td dir="ltr">非递归</td>
<td dir="ltr">布尔值（1/0）</td>
</tr>
<tr>
<td dir="ltr"><code>probability</code></td>
<td dir="ltr">触发概率（%）</td>
<td dir="ltr">数字（0-100）</td>
</tr>
<tr>
<td dir="ltr"><code>depth</code></td>
<td dir="ltr">深度</td>
<td dir="ltr">数字（0-999）</td>
</tr>
<tr>
<td dir="ltr"><code>position</code></td>
<td dir="ltr">位置</td>
<td dir="ltr">（见下文）</td>
</tr>
<tr>
<td dir="ltr"><code>role</code></td>
<td dir="ltr">深度角色</td>
<td dir="ltr">（见下文）</td>
</tr>
<tr>
<td dir="ltr"><code>scanDepth</code></td>
<td dir="ltr">扫描深度</td>
<td dir="ltr">数字（0-100）</td>
</tr>
<tr>
<td dir="ltr"><code>caseSensitive</code></td>
<td dir="ltr">区分大小写</td>
<td dir="ltr">布尔值（1/0）</td>
</tr>
<tr>
<td dir="ltr"><code>matchWholeWords</code></td>
<td dir="ltr">完整词匹配</td>
<td dir="ltr">布尔值（1/0）</td>
</tr>
</tbody>
</table></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>逻辑值</strong>
<ul>
<li data-line="1" dir="auto">0 = AND ANY（任何都满足）</li>
<li data-line="2" dir="auto">1 = NOT ALL（不是所有都满足）</li>
<li data-line="3" dir="auto">2 = NOT ANY（没有任何满足）</li>
<li data-line="4" dir="auto">3 = AND ALL（所有都满足）</li>
</ul>
</li>
<li data-line="5" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>位置值</strong>
<ul>
<li data-line="6" dir="auto">0 = 主提示词之前</li>
<li data-line="7" dir="auto">1 = 主提示词之后</li>
<li data-line="8" dir="auto">2 = 作者注释顶部</li>
<li data-line="9" dir="auto">3 = 作者注释底部</li>
<li data-line="10" dir="auto">4 = 在聊天中按深度显示</li>
<li data-line="11" dir="auto">5 = 示例消息顶部</li>
<li data-line="12" dir="auto">6 = 示例消息底部</li>
</ul>
</li>
<li data-line="13" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><strong>角色值</strong>（仅适用于位置 = 4）
<ul>
<li data-line="14" dir="auto">0 = 系统</li>
<li data-line="15" dir="auto">1 = 用户</li>
<li data-line="16" dir="auto">2 = 助手</li>
</ul>
</li>
</ul></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="示例 1：根据关键字读取世界书条目内容" dir="auto" class="heading" id="示例_1：根据关键字读取世界书条目内容"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>示例 1：根据关键字读取世界书条目内容</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/getchatbook | /setvar key=chatLore |
/findentry file={{getvar::chatLore}} field=key Shadowfang |
/getentryfield file={{getvar::chatLore}} field=key |
/echo
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="示例 2：使用关键字和内容创建世界书条目" dir="auto" class="heading" id="示例_2：使用关键字和内容创建世界书条目"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>示例 2：使用关键字和内容创建世界书条目</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/getchatbook | /setvar key=chatLore |
/createentry file={{getvar::chatLore}} key="Milla" Milla Basset is a friend of Lilac and Carol. She is a hush basset puppy who possesses the power of alchemy. |
/echo
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="示例 3：基于聊天记录扩展现有的世界书条目" dir="auto" class="heading" id="示例_3：基于聊天记录扩展现有的世界书条目"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>示例 3：基于聊天记录扩展现有的世界书条目</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/getchatbook | /setvar key=chatLore |
/findentry file={{getvar::chatLore}} field=key Milla |
/setvar key=millaUid |
/getentryfield file={{getvar::chatLore}} field=content |
/setvar key=millaContent |
/gen lock=on Tell me more about Milla Basset based on the provided conversation history. Incorporate existing information into your reply: {{getvar::millaContent}} |
/setvar key=millaContent |
/echo New content: {{pipe}} |
/setentryfield file={{getvar::chatLore}} uid=millaUid field=content {{getvar::millaContent}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="文本处理" dir="auto" class="heading" id="文本处理">文本处理</h1><div class="heading-children"><div class="el-p"><p dir="auto">有一系列有用的文本处理工具命令，可以在各种脚本场景中使用。</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/trimtokens</code> — 将输入文本修剪至指定数量的文本标记，从开头或结尾修剪，并将结果传递给后续命令。</li>
<li data-line="1" dir="auto"><code>/trimstart</code> — 将输入文本修剪至第一个完整句子的开始部分，并将结果传递给后续命令。</li>
<li data-line="2" dir="auto"><code>/trimend</code> — 将输入文本修剪至最后一个完整句子的结束部分，并将结果传递给后续命令。</li>
<li data-line="3" dir="auto"><code>/fuzzy</code> — 执行模糊匹配，将输入文本与一组字符串进行匹配，并将最佳匹配项传递给后续命令。</li>
<li data-line="4" dir="auto"><code>/regex name=scriptName [text]</code> — 执行正则表达式脚本，处理指定的文本。该脚本必须已启用。</li>
</ol></div><div class="el-h2 heading-wrapper"><h2 data-heading="`/trimtokens` 的参数" dir="auto" class="heading" id="`/trimtokens`_的参数"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><code>/trimtokens</code> 的参数</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/trimtokens limit=number direction=start/end (input)
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>direction</code> 设置修剪方向，可以是 <code>start</code> 或 <code>end</code>。默认值为 <code>end</code>。</li>
<li data-line="1" dir="auto"><code>limit</code> 设置保留的文本标记数。也可以指定包含数量的变量名。<strong>必填参数。</strong></li>
<li data-line="2" dir="auto">未命名参数是要修剪的输入文本。</li>
</ol></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="`/fuzzy` 的参数" dir="auto" class="heading" id="`/fuzzy`_的参数"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><code>/fuzzy</code> 的参数</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/fuzzy list=["candidate1","candidate2"] (input)
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>list</code> 是一个包含候选项的 JSON 序列化字符串数组。也可以指定包含候选项的变量名。<strong>必填参数。</strong></li>
<li data-line="1" dir="auto">未命名参数是要与候选项进行匹配的输入文本。输出是与输入文本最匹配的候选项之一。</li>
</ol></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="自动补全" dir="auto" class="heading" id="自动补全">自动补全</h1><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">自动补全在聊天输入框和大型快速回复编辑器中均已启用。</li>
<li data-line="1" dir="auto">自动补全会在输入的任何地方起作用，甚至在多个管道命令和嵌套闭包中。</li>
<li data-line="2" dir="auto">自动补全支持三种查找匹配命令的方式（在用户设置中配置）：</li>
</ul></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><strong>以...开头</strong> 传统方式。只有以输入值开头的命令会显示。</li>
<li data-line="1" dir="auto"><strong>包含...</strong> 所有包含输入值的命令都会显示。例如：当输入 <code>/delete</code> 时，命令 <code>/qr-delete</code> 和 <code>/qr-set-delete</code> 会显示在自动补全列表中（/qr-<strong>delete</strong>，/qr-set-<strong>delete</strong>）。</li>
<li data-line="2" dir="auto"><strong>模糊匹配</strong> 所有可以模糊匹配的命令都会显示。例如：当输入 <code>/seas</code> 时，命令 <code>/sendas</code> 会出现在自动补全列表中（/<strong>se</strong>nd<strong>as</strong>）。</li>
</ol></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">命令参数也支持自动补全。当输入必填参数时，自动补全列表会自动显示。对于可选参数，按 <em>Ctrl</em>+<em>Space</em> 可以打开可用选项列表。</li>
<li data-line="1" dir="auto">当输入 <code>/:</code> 来执行闭包或快速回复时，自动补全会显示可用的作用域变量和快速回复。</li>
<li data-line="2" dir="auto">自动补全也支持一定程度的宏（在斜杠命令中）。输入 <code>{{</code> 可以查看可用宏列表。</li>
<li data-line="3" dir="auto">使用 <em>上下 箭头键</em> 可在自动补全列表中选择选项。</li>
<li data-line="4" dir="auto">按 <em>Enter</em>、<em>Tab</em> 或 <em>点击</em> 选项可将其放置在光标处。</li>
<li data-line="5" dir="auto">按 <em>Escape</em> 关闭自动补全列表。</li>
<li data-line="6" dir="auto">按 <em>Ctrl</em>+<em>Space</em> 可打开或切换已选择选项的详细信息。</li>
</ul></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="解析器标志" dir="auto" class="heading" id="解析器标志">解析器标志</h1><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/parser-flag
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">解析器接受标志来修改其行为。这些标志可以在脚本的任何位置切换，所有后续输入会根据当前的标志进行评估。
您可以在用户设置中设置默认标志。
## 严格转义
```stscript
/parser-flag STRICT_ESCAPING on |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">启用 <code>STRICT_ESCAPING</code> 后的变化如下：</p></div><div class="el-h3 heading-wrapper"><h3 data-heading="管道符" dir="auto" class="heading" id="管道符"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>管道符</h3><div class="heading-children"><div class="el-p"><p dir="auto">在引号内的值中不需要转义管道符。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo title="a|b" c\\\\\\\\|d
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="反斜杠" dir="auto" class="heading" id="反斜杠"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>反斜杠</h3><div class="heading-children"><div class="el-p"><p dir="auto">在符号前使用反斜杠时，可以转义，以提供字面意义上的反斜杠符号。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">// 这将先输出 "foo \\\\\\\\", 然后输出 "bar" |
/echo foo \\\\\\\\\\\\\\\\|
/echo bar
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo \\\\\\\\\\\\\\\\|
/echo \\\\\\\\\\\\\\\\\\\\\\\\|
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="替换变量宏" dir="auto" class="heading" id="替换变量宏"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>替换变量宏</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/parser-flag REPLACE_GETVAR on |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">此标志有助于避免当变量值包含可以被解释为宏的文本时发生双重替换。<code>{{var::}}</code> 宏会最后被替换，结果文本/变量值中不会再进行进一步的替换。</p></div><div class="el-p"><p dir="auto">替换所有</p></div><div class="el-p"><p dir="auto"><code>{{getvar::}}</code> 和 <code>{{getglobalvar::}}</code> 宏为 <code>{{var::}}</code>。 在后台，解析器将插入一系列命令执行器，以确保正确的变量替换顺序：</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">调用 <code>/let</code> 保存当前的 <code>{{pipe}}</code> 到作用域变量中</li>
<li data-line="1" dir="auto">调用 <code>/getvar</code> 或 <code>/getglobalvar</code> 获取宏中使用的变量</li>
<li data-line="2" dir="auto">调用 <code>/let</code> 保存检索到的变量到作用域变量</li>
<li data-line="3" dir="auto">调用 <code>/return</code> 将保存的 <code>{{pipe}}</code> 值恢复到正确的后续命令中</li>
</ul></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">// 以下命令会输出最后一条消息的 ID 或编号 |
/setvar key=x \\\\\\\\{\\\\\\\\{lastMessageId}} |
/echo {{getvar::x}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">// 这将输出字面文本 {{lastMessageId}} |
/parser-flag REPLACE_GETVAR |
/setvar key=x \\\\\\\\{\\\\\\\\{lastMessageId}} |
/echo {{getvar::x}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="快速回复：脚本库与自动执行" dir="auto" class="heading" id="快速回复：脚本库与自动执行">快速回复：脚本库与自动执行</h1><div class="heading-children"><div class="el-p"><p dir="auto"><strong>Quick Replies</strong> 是 SillyTavern 内置的扩展，提供了一种便捷的方式来存储和执行脚本。</p></div><div class="el-h2 heading-wrapper"><h2 data-heading="配置快速回复" dir="auto" class="heading" id="配置快速回复"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>配置快速回复</h2><div class="heading-children"><div class="el-p"><p dir="auto">要开始使用，请打开扩展面板（叠加块图标），并展开</p></div><div class="el-p"><p dir="auto"><strong>Quick Replies</strong></p></div><div class="el-p"><p dir="auto">菜单。</p></div><div class="el-p"><p dir="auto"></p><div alt="quick-reply" src="lib/media/20241222161559037.png" class="internal-embed media-embed image-embed is-loaded"><img alt="quick-reply" src="lib/media/20241222161559037.png"></div><p dir="auto"></p></div><div class="el-p"><p dir="auto"><strong>快速回复默认是禁用的，您需要首先启用它。</strong></p></div><div class="el-p"><p dir="auto">启用后，您将在聊天输入框上方看到一个按钮栏。</p></div><div class="el-p"><p dir="auto">您可以设置显示的按钮文本标签（我们建议使用表情符号以简洁明了），并在点击按钮时执行的脚本。</p></div><div class="el-p"><p dir="auto">按钮的数量由</p></div><div class="el-p"><p dir="auto"><strong>按钮数量</strong></p></div><div class="el-p"><p dir="auto">设置控制（最大值 = 100），根据需要调整并点击 "应用" 完成。</p></div><div class="el-p"><p dir="auto"><strong>建议在使用 STscript 时禁用自动注入用户输入</strong></p></div><div class="el-p"><p dir="auto">，否则可能会干扰您的输入，使用</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">{{input}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">宏来获取当前输入框的值。</p></div><div class="el-p"><p dir="auto"><strong>快速回复预设</strong></p></div><div class="el-p"><p dir="auto">允许您拥有多个预定义的快速回复集，可以手动切换或通过使用</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/qrset (预设名称)
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">命令切换。 在切换到不同的预设之前，别忘了点击 "更新"，以将更改写入当前使用的预设！</p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="手动执行" dir="auto" class="heading" id="手动执行"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>手动执行</h2><div class="heading-children"><div class="el-p"><p dir="auto">现在，您可以将第一个脚本添加到库中。选择任何一个空闲的槽位（或创建一个），在左侧框中输入 "点击我" 来设置标签，然后将以下内容粘贴到右侧框中：</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/addvar key=clicks 1 |
/if left=clicks right=5 rule=eq else="/echo 继续加油..." "/echo 你做到了！ \\\\\\\\| /flushvar clicks"
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">然后点击上方聊天框的按钮 5 次。 每次点击都会将变量 <code>clicks</code> 增加 1，并在值等于 5 时显示不同的消息并重置该变量。</p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="自动执行" dir="auto" class="heading" id="自动执行"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>自动执行</h2><div class="heading-children"></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="点击创建的命令旁的 `⋮` 按钮打开弹出菜单。" dir="auto" class="heading" id="点击创建的命令旁的_`⋮`_按钮打开弹出菜单。"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>点击创建的命令旁的 <code>⋮</code> 按钮打开弹出菜单。</h2><div class="heading-children"><div class="el-p"><p dir="auto"></p><div alt="autoexecute" src="lib/media/20241222161559038.png" class="internal-embed media-embed image-embed is-loaded"><img alt="autoexecute" src="lib/media/20241222161559038.png"></div><p dir="auto"></p></div><div class="el-p"><p dir="auto">在此菜单中，您可以执行以下操作：</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">在便捷的全屏编辑器中编辑脚本</li>
<li data-line="1" dir="auto">隐藏按钮，使其仅用于自动执行</li>
<li data-line="2" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>启用在以下条件下的自动执行：
<ul>
<li data-line="3" dir="auto">应用启动时</li>
<li data-line="4" dir="auto">发送用户消息时</li>
<li data-line="5" dir="auto">接收到 AI 消息时</li>
<li data-line="6" dir="auto">打开角色或群组聊天时</li>
<li data-line="7" dir="auto">触发群组成员的回复时</li>
<li data-line="8" dir="auto">使用相同自动化 ID 激活世界书条目时</li>
</ul>
</li>
<li data-line="9" dir="auto">为快速回复提供自定义提示（悬停在按钮上时显示的文本）</li>
<li data-line="10" dir="auto">测试时执行脚本<br>
仅在启用 <strong>Quick Replies</strong> 扩展时，命令才会自动执行。<br>
例如，您可以在发送五条用户消息后显示一条消息，将以下脚本添加并设置为在用户消息时自动执行。</li>
</ul></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/addvar key=usercounter 1 |
/echo 您已发送 {{pipe}} 条消息。 |
/if left=usercounter right=5 rule=gte "/echo 游戏结束！ \\\\\\\\| /flushvar usercounter"
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="调试器" dir="auto" class="heading" id="调试器"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>调试器</h2><div class="heading-children"><div class="el-p"><p dir="auto">快速回复编辑器中提供了一个基本的调试器。您可以在脚本中的任何位置设置断点 <code>/breakpoint |</code>，在从 QR 编辑器执行脚本时，执行将在该点暂停，允许您检查当前可用的变量、管道、命令参数等，并逐步执行脚本。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let x {: n=1
	/echo n 的值是 {{var::n}} |
	/mul n n |
:} |
/breakpoint |
/:x n=3 |
/echo 结果是 {{pipe}} |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"></p><div alt="st-debugger" src="lib/media/20241222161559039.png" class="internal-embed media-embed image-embed is-loaded"><img alt="st-debugger" src="lib/media/20241222161559039.png"></div><p dir="auto"></p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="调用程序" dir="auto" class="heading" id="调用程序"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>调用程序</h2><div class="heading-children"><div class="el-p"><p dir="auto"><code>/run</code> 命令可以通过其标签调用快速回复中定义的脚本，基本上提供了定义可重用脚本块并返回结果的能力。这使得其他脚本可以引用这些脚本块。程序返回的最后一个管道结果会传递到下一个命令。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/run ScriptLabel
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="让我们创建两个快速回复：" dir="auto" class="heading" id="让我们创建两个快速回复："><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>让我们创建两个快速回复：</h2><div class="heading-children"><div class="el-p"><p dir="auto"><strong>标签：</strong><code>GetRandom</code><strong>命令：</strong></p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/pass {{roll:d100}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-hr"><hr></div><div class="el-p"><p dir="auto"><strong>标签：</strong><code>GetMessage</code><strong>命令：</strong></p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/run GetRandom | /echo 你的幸运数字是：{{pipe}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-hr"><hr></div><div class="el-p"><p dir="auto">点击 <code>GetMessage</code> 按钮将调用 <code>GetRandom</code> 程序，它将解析 <code>{{roll}}</code> 宏并将数字传递给调用者，显示给用户。</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">程序不接受命名或未命名的参数，但可以引用与调用者相同的变量。</li>
<li data-line="1" dir="auto">避免递归调用程序，因为如果处理不当可能会导致 "调用栈溢出" 错误。</li>
</ul></div><div class="el-h3 heading-wrapper"><h3 data-heading="从不同的快速回复预设中调用程序" dir="auto" class="heading" id="从不同的快速回复预设中调用程序"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>从不同的快速回复预设中调用程序</h3><div class="heading-children"><div class="el-p"><p dir="auto">您可以使用 <code>a.b</code> 语法从不同的快速回复预设中调用程序，其中 <code>a</code> 是快速回复预设名称，<code>b</code> 是快速回复标签名称。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/run QRpreset1.QRlabel1
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">默认情况下，系统会首先查找快速回复标签 <code>a.b</code>，所以如果您的标签正好是 "QRpreset1.QRlabel1"，它将尝试运行该标签。如果没有找到这样的标签，它会在名为 "QRpreset1" 的快速回复预设中查找名为 "QRlabel1" 的标签。</p></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="快速回复管理命令" dir="auto" class="heading" id="快速回复管理命令"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>快速回复管理命令</h2><div class="heading-children"><div class="el-h3 heading-wrapper"><h3 data-heading="创建快速回复" dir="auto" class="heading" id="创建快速回复"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>创建快速回复</h3><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">
<p><code>/qr-create (arguments, [message])</code> – 创建一个新的快速回复，示例：<code>/qr-create set=MyPreset label=MyButton /echo 123</code><br>
参数：</p>
</li>
<li data-line="3" dir="auto">
<p><code>label</code> - 字符串 - 按钮上的文本，例如 <code>label=MyButton</code></p>
</li>
<li data-line="4" dir="auto">
<p><code>set</code> - 字符串 - 快速回复集的名称，例如 <code>set=PresetName1</code></p>
</li>
<li data-line="5" dir="auto">
<p><code>hidden</code> - 布尔值 - 按钮是否应隐藏，例如 <code>hidden=true</code></p>
</li>
<li data-line="6" dir="auto">
<p><code>startup</code> - 布尔值 - 在应用启动时自动执行，例如 <code>startup=true</code></p>
</li>
<li data-line="7" dir="auto">
<p><code>user</code> - 布尔值 - 在用户消息时自动执行，例如 <code>user=true</code></p>
</li>
<li data-line="8" dir="auto">
<p><code>bot</code> - 布尔值 - 在 AI 消息时自动执行，例如 <code>bot=true</code></p>
</li>
<li data-line="9" dir="auto">
<p><code>load</code> - 布尔值 - 在加载聊天时自动执行，例如 <code>load=true</code></p>
</li>
<li data-line="10" dir="auto">
<p><code>title</code> - 布尔值 - 在按钮上显示的标题/提示文本，例如 <code>title="My Fancy Button"</code></p>
</li>
</ul></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="删除快速回复" dir="auto" class="heading" id="删除快速回复"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>删除快速回复</h3><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>/qr-delete (set=string [label])</code> – 删除快速回复</li>
</ul></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="更新快速回复" dir="auto" class="heading" id="更新快速回复"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>更新快速回复</h3><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">
<p><code>/qr-update (arguments, [message])</code> – 更新快速回复，示例：<code>/qr-update set=MyPreset label=MyButton newlabel=MyRenamedButton /echo 123</code><br>
参数：</p>
</li>
<li data-line="3" dir="auto">
<p><code>newlabel</code> - 字符串 - 按钮的新文本，例如 <code>newlabel=MyRenamedButton</code></p>
</li>
<li data-line="4" dir="auto">
<p><code>label</code> - 字符串 - 按钮的文本，例如 <code>label=MyButton</code></p>
</li>
<li data-line="5" dir="auto">
<p><code>set</code> - 字符串 - 快速回复集的名称，例如 <code>set=PresetName1</code></p>
</li>
<li data-line="6" dir="auto">
<p><code>hidden</code> - 布尔值 - 按钮是否应隐藏，例如 <code>hidden=true</code></p>
</li>
<li data-line="7" dir="auto">
<p><code>startup</code> - 布尔值 - 在应用启动时自动执行，例如 <code>startup=true</code></p>
</li>
<li data-line="8" dir="auto">
<p><code>user</code> - 布尔值 - 在用户消息时自动执行，例如 <code>user=true</code></p>
</li>
<li data-line="9" dir="auto">
<p><code>bot</code> - 布尔值 - 在 AI 消息时自动执行，例如 <code>bot=true</code></p>
</li>
<li data-line="10" dir="auto">
<p><code>load</code> - 布尔值 - 在加载聊天时自动执行，例如 <code>load=true</code></p>
</li>
<li data-line="11" dir="auto">
<p><code>title</code> - 布尔值 - 在按钮上显示的标题/提示文本，例如 <code>title="My Fancy Button"</code></p>
</li>
</ul></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="获取快速回复" dir="auto" class="heading" id="获取快速回复"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>获取快速回复</h3><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>/qr-get</code> - 检索快速回复的所有属性，示例：<code>/qr-get set=myQrSet id=42</code></li>
</ul></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="创建或更新 QR 预设" dir="auto" class="heading" id="创建或更新_QR_预设"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>创建或更新 QR 预设</h3><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">
<p><code>/qr-presetupdate (arguments [label])</code> 或 <code>/qr-presetadd (arguments [label])</code><br>
参数：</p>
</li>
<li data-line="3" dir="auto">
<p><code>enabled</code> - 布尔值 - 启用或禁用预设</p>
</li>
<li data-line="4" dir="auto">
<p><code>nosend</code> - 布尔值 - 禁用发送/插入用户输入（对于斜杠命令无效）</p>
</li>
<li data-line="5" dir="auto">
<p><code>before</code> - 布尔值 - 将快速回复放置在用户输入之前</p>
</li>
<li data-line="6" dir="auto">
<p><code>slots</code> - 整数 - 插槽数量</p>
</li>
<li data-line="7" dir="auto">
<p><code>inject</code> - 布尔值 - 是否自动注入用户输入（如果禁用，请使用 <code>{{input}}</code>）<br>
创建一个新的预设（会覆盖现有预设），示例：<br>
<code>/qr-presetadd slots=3 MyNewPreset</code></p>
</li>
</ul></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="添加 QR 上下文菜单" dir="auto" class="heading" id="添加_QR_上下文菜单"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>添加 QR 上下文菜单</h3><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>/qr-contextadd (set=string label=string chain=bool [preset name])</code> – 将上下文菜单预设添加到 QR，示例：<code>/qr-contextadd set=MyPreset label=MyButton chain=true MyOtherPreset</code></li>
</ul></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="删除所有上下文菜单" dir="auto" class="heading" id="删除所有上下文菜单"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>删除所有上下文菜单</h3><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>/qr-contextclear (set=string [label])</code> – 删除 QR 中的所有上下文菜单，示例：<code>/qr-contextclear set=MyPreset MyButton</code></li>
</ul></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="删除单个上下文菜单" dir="auto" class="heading" id="删除单个上下文菜单"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>删除单个上下文菜单</h3><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>/qr-contextdel (set=string label=string [preset name])</code> – 删除 QR 中的单个上下文菜单，示例：<code>/qr-contextdel set=MyPreset label=MyButton MyOtherPreset</code></li>
</ul></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="快速回复值转义" dir="auto" class="heading" id="快速回复值转义"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>快速回复值转义</h2><div class="heading-children"><div class="el-p"><p dir="auto">在 QR 消息/命令中，<code>|{}</code> 可以通过反斜杠进行转义。</p></div><div class="el-p"><p dir="auto">例如，使用</p></div><div class="el-p"><p dir="auto"><code>/qr-create label=MyButton /getvar myvar \\\\\\\\| /echo \\\\\\\\{\\\\\\\\{pipe\\\\\\\\}\\\\\\\\}</code> 创建一个快速回复，该回复调用 <code>/getvar myvar | /echo {{pipe}}</code>。</p></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="扩展命令" dir="auto" class="heading" id="扩展命令">扩展命令</h1><div class="heading-children"><div class="el-p"><p dir="auto">SillyTavern 扩展（包括内置、可下载和第三方扩展）可以添加自己的斜杠命令。以下仅为官方扩展功能的示例，可能不完全，确保查看 <code>/help slash</code> 获取最完整的可用命令列表。</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/websearch (查询)</code> — 在线搜索指定查询的网页片段，并将结果返回到管道中。由 Web Search 扩展提供。</li>
<li data-line="1" dir="auto"><code>/imagine (提示词)</code> — 使用提供的提示词生成图像。由 Image Generation 扩展提供。</li>
<li data-line="2" dir="auto"><code>/emote (精灵)</code> — 通过模糊匹配角色的名称设置当前角色的精灵表情。由 Character Expressions 扩展提供。</li>
<li data-line="3" dir="auto"><code>/costume (子文件夹)</code> — 为当前角色设置精灵集覆盖。由 Character Expressions 扩展提供。</li>
<li data-line="4" dir="auto"><code>/music (名称)</code> — 强制更改正在播放的背景音乐文件，按名称指定。由 Dynamic Audio 扩展提供。</li>
<li data-line="5" dir="auto"><code>/ambient (名称)</code> — 强制更改正在播放的环境音效文件，按名称指定。由 Dynamic Audio 扩展提供。</li>
<li data-line="6" dir="auto"><code>/roll (骰子公式)</code> — 在聊天中添加一个隐藏消息，显示骰子掷出的结果。由 D&amp;D Dice 扩展提供。</li>
</ol></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="用户界面交互" dir="auto" class="heading" id="用户界面交互">用户界面交互</h1><div class="heading-children"><div class="el-p"><p dir="auto">脚本还可以与 SillyTavern 的用户界面进行交互：导航聊天或更改样式参数。</p></div><div class="el-h2 heading-wrapper"><h2 data-heading="角色导航" dir="auto" class="heading" id="角色导航"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>角色导航</h2><div class="heading-children"><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/random</code> — 打开与随机角色的聊天。</li>
<li data-line="1" dir="auto"><code>/go (名称)</code> — 打开与指定名称角色的聊天。首先，会搜索完全匹配的名称，然后按前缀匹配，再按子字符串匹配。</li>
</ol></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="用户界面样式" dir="auto" class="heading" id="用户界面样式"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>用户界面样式</h2><div class="heading-children"><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/bubble</code> — 设置消息样式为“气泡聊天”风格。</li>
<li data-line="1" dir="auto"><code>/flat</code> — 设置消息样式为“平面聊天”风格。</li>
<li data-line="2" dir="auto"><code>/single</code> — 设置消息样式为“单文档”风格。</li>
<li data-line="3" dir="auto"><code>/movingui (名称)</code> — 激活名为“MovingUI”的预设。</li>
<li data-line="4" dir="auto"><code>/resetui</code> — 重置 MovingUI 面板的状态到其原始位置。</li>
<li data-line="5" dir="auto"><code>/panels</code> — 切换用户界面面板的可见性：顶部栏、左侧和右侧抽屉。</li>
<li data-line="6" dir="auto"><code>/bg (名称)</code> — 根据模糊匹配的名称查找并设置背景。遵循聊天背景锁定状态。</li>
<li data-line="7" dir="auto"><code>/lockbg</code> — 锁定当前聊天的背景图像。</li>
<li data-line="8" dir="auto"><code>/unlockbg</code> — 解锁当前聊天的背景图像。</li>
</ol></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="更多示例" dir="auto" class="heading" id="更多示例">更多示例</h1><div class="heading-children"><div class="el-h2 heading-wrapper"><h2 data-heading="生成聊天摘要（由 @IkariDevGIT 提供）" dir="auto" class="heading" id="生成聊天摘要（由_@IkariDevGIT_提供）"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>生成聊天摘要（由 @IkariDevGIT 提供）</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/setglobalvar key=summaryPrompt 总结在给定的聊天中发生的最重要的事实和事件。将摘要限制为100字以内。你的回答应仅包括摘要内容。 |
/setvar key=tmp |
/messages 0-{{lastMessageId}} |
/trimtokens limit=3000 direction=end |
/setvar key=s1 |
/echo 正在生成，请稍等... |
/genraw lock=on instruct=off {{instructInput}}{{newline}}{{getglobalvar::summaryPrompt}}{{newline}}{{newline}}{{instructInput}}{{newline}}{{getvar::s1}}{{newline}}{{newline}}{{instructOutput}}{{newline}}聊天摘要：{{newline}} |
/setvar key=tmp |
/echo 完成！ |
/setinput {{getvar::tmp}} |
/flushvar tmp |
/flushvar s1
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="按钮弹出使用" dir="auto" class="heading" id="按钮弹出使用"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>按钮弹出使用</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/setglobalvar key=genders ["男孩", "女孩", "其他"] |
/buttons labels=genders 你是谁？ |
/echo 你选择了：{{pipe}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="获取第 N 个斐波那契数（使用 Binet 公式）" dir="auto" class="heading" id="获取第_N_个斐波那契数（使用_Binet_公式）"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>获取第 N 个斐波那契数（使用 Binet 公式）</h2><div class="heading-children"><div class="el-blockquote"><blockquote dir="auto">
<p>提示：将 fib_no 设置为所需的数字</p>
</blockquote></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/setvar key=fib_no 5 |
/pow 5 0.5 | /setglobalvar key=SQRT5 |
/setglobalvar key=PHI 1.618033 |
/pow PHI fib_no | /div {{pipe}} SQRT5 |
/round |
/echo 第{{getvar::fib_no}}个斐波那契数是：{{pipe}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="递归阶乘（使用闭包）" dir="auto" class="heading" id="递归阶乘（使用闭包）"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>递归阶乘（使用闭包）</h2><div class="heading-children"><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let fact {: n=
    /if left={{var::n}} rule=gt right=1
        else={:
            /return 1
        :}
        {:
            /sub {{var::n}} 1 |
            /:fact n={{pipe}} |
            /mul {{var::n}} {{pipe}}
        :}
:} |
/input 计算阶乘：|
/let n {{pipe}} |
/:fact n={{var::n}} |
/echo {{var::n}}的阶乘是 {{pipe}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="mod-footer mod-ui"></div></div></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#STscript 语言参考"><div class="tree-item-contents heading-link" heading-name="STscript 语言参考"><span class="tree-item-title">STscript 语言参考</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#什么是_STscript？"><div class="tree-item-contents heading-link" heading-name="什么是 STscript？"><span class="tree-item-title">什么是 STscript？</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#安全预防"><div class="tree-item-contents heading-link" heading-name="安全预防"><span class="tree-item-title">安全预防</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#Hello,_World!"><div class="tree-item-contents heading-link" heading-name="Hello, World!"><span class="tree-item-title">Hello, World!</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#用户输入"><div class="tree-item-contents heading-link" heading-name="用户输入"><span class="tree-item-title">用户输入</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#其他输入/输出命令"><div class="tree-item-contents heading-link" heading-name="其他输入/输出命令"><span class="tree-item-title">其他输入/输出命令</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#`/popup`_和_`/input`_的额外参数"><div class="tree-item-contents heading-link" heading-name="`/popup` 和 `/input` 的额外参数"><span class="tree-item-title"><code>/popup</code> 和 <code>/input</code> 的额外参数</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#`/echo`_的参数"><div class="tree-item-contents heading-link" heading-name="`/echo` 的参数"><span class="tree-item-title"><code>/echo</code> 的参数</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#变量"><div class="tree-item-contents heading-link" heading-name="变量"><span class="tree-item-title">变量</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#数组和对象"><div class="tree-item-contents heading-link" heading-name="数组和对象"><span class="tree-item-title">数组和对象</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#流程控制_-_条件语句"><div class="tree-item-contents heading-link" heading-name="流程控制 - 条件语句"><span class="tree-item-title">流程控制 - 条件语句</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#`/if`_参数"><div class="tree-item-contents heading-link" heading-name="`/if` 参数"><span class="tree-item-title"><code>/if</code> 参数</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#布尔运算"><div class="tree-item-contents heading-link" heading-name="布尔运算"><span class="tree-item-title">布尔运算</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#子命令"><div class="tree-item-contents heading-link" heading-name="子命令"><span class="tree-item-title">子命令</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#转义序列"><div class="tree-item-contents heading-link" heading-name="转义序列"><span class="tree-item-title">转义序列</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#宏"><div class="tree-item-contents heading-link" heading-name="宏"><span class="tree-item-title">宏</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#管道符"><div class="tree-item-contents heading-link" heading-name="管道符"><span class="tree-item-title">管道符</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#引号"><div class="tree-item-contents heading-link" heading-name="引号"><span class="tree-item-title">引号</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#空格"><div class="tree-item-contents heading-link" heading-name="空格"><span class="tree-item-title">空格</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#闭包定界符"><div class="tree-item-contents heading-link" heading-name="闭包定界符"><span class="tree-item-title">闭包定界符</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#管道断开符"><div class="tree-item-contents heading-link" heading-name="管道断开符"><span class="tree-item-title">管道断开符</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#闭包"><div class="tree-item-contents heading-link" heading-name="闭包"><span class="tree-item-title">闭包</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#子命令"><div class="tree-item-contents heading-link" heading-name="子命令"><span class="tree-item-title">子命令</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#作用域"><div class="tree-item-contents heading-link" heading-name="作用域"><span class="tree-item-title">作用域</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#命名闭包"><div class="tree-item-contents heading-link" heading-name="命名闭包"><span class="tree-item-title">命名闭包</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#闭包参数"><div class="tree-item-contents heading-link" heading-name="闭包参数"><span class="tree-item-title">闭包参数</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#闭包和管道参数"><div class="tree-item-contents heading-link" heading-name="闭包和管道参数"><span class="tree-item-title">闭包和管道参数</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#立即执行闭包"><div class="tree-item-contents heading-link" heading-name="立即执行闭包"><span class="tree-item-title">立即执行闭包</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#注释"><div class="tree-item-contents heading-link" heading-name="注释"><span class="tree-item-title">注释</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#块注释"><div class="tree-item-contents heading-link" heading-name="块注释"><span class="tree-item-title">块注释</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#流程控制"><div class="tree-item-contents heading-link" heading-name="流程控制"><span class="tree-item-title">流程控制</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#循环：`/while`_和_`/times`"><div class="tree-item-contents heading-link" heading-name="循环：`/while` 和 `/times`"><span class="tree-item-title">循环：<code>/while</code> 和 <code>/times</code></span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#`/while`_的参数"><div class="tree-item-contents heading-link" heading-name="`/while` 的参数"><span class="tree-item-title"><code>/while</code> 的参数</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#`/times`_的参数"><div class="tree-item-contents heading-link" heading-name="`/times` 的参数"><span class="tree-item-title"><code>/times</code> 的参数</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#跳出循环和闭包"><div class="tree-item-contents heading-link" heading-name="跳出循环和闭包"><span class="tree-item-title">跳出循环和闭包</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#数学运算"><div class="tree-item-contents heading-link" heading-name="数学运算"><span class="tree-item-title">数学运算</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#示例_1：计算半径为_50_的圆的面积。"><div class="tree-item-contents heading-link" heading-name="示例 1：计算半径为 50 的圆的面积。"><span class="tree-item-title">示例 1：计算半径为 50 的圆的面积。</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#示例_2：计算_5_的阶乘。"><div class="tree-item-contents heading-link" heading-name="示例 2：计算 5 的阶乘。"><span class="tree-item-title">示例 2：计算 5 的阶乘。</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#使用_LLM（大语言模型）"><div class="tree-item-contents heading-link" heading-name="使用 LLM（大语言模型）"><span class="tree-item-title">使用 LLM（大语言模型）</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#`/gen`_和_`/genraw`_的参数"><div class="tree-item-contents heading-link" heading-name="`/gen` 和 `/genraw` 的参数"><span class="tree-item-title"><code>/gen</code> 和 <code>/genraw</code> 的参数</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#提示词注入"><div class="tree-item-contents heading-link" heading-name="提示词注入"><span class="tree-item-title">提示词注入</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#`/inject`_的参数"><div class="tree-item-contents heading-link" heading-name="`/inject` 的参数"><span class="tree-item-title"><code>/inject</code> 的参数</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#访问聊天消息"><div class="tree-item-contents heading-link" heading-name="访问聊天消息"><span class="tree-item-title">访问聊天消息</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#读取消息"><div class="tree-item-contents heading-link" heading-name="读取消息"><span class="tree-item-title">读取消息</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#发送消息"><div class="tree-item-contents heading-link" heading-name="发送消息"><span class="tree-item-title">发送消息</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#删除消息"><div class="tree-item-contents heading-link" heading-name="删除消息"><span class="tree-item-title">删除消息</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#世界书（World_Info）命令"><div class="tree-item-contents heading-link" heading-name="世界书（World Info）命令"><span class="tree-item-title">世界书（World Info）命令</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#有效字段"><div class="tree-item-contents heading-link" heading-name="有效字段"><span class="tree-item-title">有效字段</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#示例_1：根据关键字读取世界书条目内容"><div class="tree-item-contents heading-link" heading-name="示例 1：根据关键字读取世界书条目内容"><span class="tree-item-title">示例 1：根据关键字读取世界书条目内容</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#示例_2：使用关键字和内容创建世界书条目"><div class="tree-item-contents heading-link" heading-name="示例 2：使用关键字和内容创建世界书条目"><span class="tree-item-title">示例 2：使用关键字和内容创建世界书条目</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#示例_3：基于聊天记录扩展现有的世界书条目"><div class="tree-item-contents heading-link" heading-name="示例 3：基于聊天记录扩展现有的世界书条目"><span class="tree-item-title">示例 3：基于聊天记录扩展现有的世界书条目</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#文本处理"><div class="tree-item-contents heading-link" heading-name="文本处理"><span class="tree-item-title">文本处理</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#`/trimtokens`_的参数"><div class="tree-item-contents heading-link" heading-name="`/trimtokens` 的参数"><span class="tree-item-title"><code>/trimtokens</code> 的参数</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#`/fuzzy`_的参数"><div class="tree-item-contents heading-link" heading-name="`/fuzzy` 的参数"><span class="tree-item-title"><code>/fuzzy</code> 的参数</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#自动补全"><div class="tree-item-contents heading-link" heading-name="自动补全"><span class="tree-item-title">自动补全</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#解析器标志"><div class="tree-item-contents heading-link" heading-name="解析器标志"><span class="tree-item-title">解析器标志</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#管道符"><div class="tree-item-contents heading-link" heading-name="管道符"><span class="tree-item-title">管道符</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#反斜杠"><div class="tree-item-contents heading-link" heading-name="反斜杠"><span class="tree-item-title">反斜杠</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#替换变量宏"><div class="tree-item-contents heading-link" heading-name="替换变量宏"><span class="tree-item-title">替换变量宏</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#快速回复：脚本库与自动执行"><div class="tree-item-contents heading-link" heading-name="快速回复：脚本库与自动执行"><span class="tree-item-title">快速回复：脚本库与自动执行</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#配置快速回复"><div class="tree-item-contents heading-link" heading-name="配置快速回复"><span class="tree-item-title">配置快速回复</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#手动执行"><div class="tree-item-contents heading-link" heading-name="手动执行"><span class="tree-item-title">手动执行</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#自动执行"><div class="tree-item-contents heading-link" heading-name="自动执行"><span class="tree-item-title">自动执行</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#点击创建的命令旁的_`⋮`_按钮打开弹出菜单。"><div class="tree-item-contents heading-link" heading-name="点击创建的命令旁的 `⋮` 按钮打开弹出菜单。"><span class="tree-item-title">点击创建的命令旁的 <code>⋮</code> 按钮打开弹出菜单。</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#调试器"><div class="tree-item-contents heading-link" heading-name="调试器"><span class="tree-item-title">调试器</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#调用程序"><div class="tree-item-contents heading-link" heading-name="调用程序"><span class="tree-item-title">调用程序</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#让我们创建两个快速回复："><div class="tree-item-contents heading-link" heading-name="让我们创建两个快速回复："><span class="tree-item-title">让我们创建两个快速回复：</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#从不同的快速回复预设中调用程序"><div class="tree-item-contents heading-link" heading-name="从不同的快速回复预设中调用程序"><span class="tree-item-title">从不同的快速回复预设中调用程序</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#快速回复管理命令"><div class="tree-item-contents heading-link" heading-name="快速回复管理命令"><span class="tree-item-title">快速回复管理命令</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#创建快速回复"><div class="tree-item-contents heading-link" heading-name="创建快速回复"><span class="tree-item-title">创建快速回复</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#删除快速回复"><div class="tree-item-contents heading-link" heading-name="删除快速回复"><span class="tree-item-title">删除快速回复</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#更新快速回复"><div class="tree-item-contents heading-link" heading-name="更新快速回复"><span class="tree-item-title">更新快速回复</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#获取快速回复"><div class="tree-item-contents heading-link" heading-name="获取快速回复"><span class="tree-item-title">获取快速回复</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#创建或更新_QR_预设"><div class="tree-item-contents heading-link" heading-name="创建或更新 QR 预设"><span class="tree-item-title">创建或更新 QR 预设</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#添加_QR_上下文菜单"><div class="tree-item-contents heading-link" heading-name="添加 QR 上下文菜单"><span class="tree-item-title">添加 QR 上下文菜单</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#删除所有上下文菜单"><div class="tree-item-contents heading-link" heading-name="删除所有上下文菜单"><span class="tree-item-title">删除所有上下文菜单</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#删除单个上下文菜单"><div class="tree-item-contents heading-link" heading-name="删除单个上下文菜单"><span class="tree-item-title">删除单个上下文菜单</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#快速回复值转义"><div class="tree-item-contents heading-link" heading-name="快速回复值转义"><span class="tree-item-title">快速回复值转义</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#扩展命令"><div class="tree-item-contents heading-link" heading-name="扩展命令"><span class="tree-item-title">扩展命令</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#用户界面交互"><div class="tree-item-contents heading-link" heading-name="用户界面交互"><span class="tree-item-title">用户界面交互</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#角色导航"><div class="tree-item-contents heading-link" heading-name="角色导航"><span class="tree-item-title">角色导航</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#用户界面样式"><div class="tree-item-contents heading-link" heading-name="用户界面样式"><span class="tree-item-title">用户界面样式</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#更多示例"><div class="tree-item-contents heading-link" heading-name="更多示例"><span class="tree-item-title">更多示例</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#生成聊天摘要（由_@IkariDevGIT_提供）"><div class="tree-item-contents heading-link" heading-name="生成聊天摘要（由 @IkariDevGIT 提供）"><span class="tree-item-title">生成聊天摘要（由 @IkariDevGIT 提供）</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#按钮弹出使用"><div class="tree-item-contents heading-link" heading-name="按钮弹出使用"><span class="tree-item-title">按钮弹出使用</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#获取第_N_个斐波那契数（使用_Binet_公式）"><div class="tree-item-contents heading-link" heading-name="获取第 N 个斐波那契数（使用 Binet 公式）"><span class="tree-item-title">获取第 N 个斐波那契数（使用 Binet 公式）</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="sillytavern\4-开发与自动化\4.1-stscript-语言参考.html#递归阶乘（使用闭包）"><div class="tree-item-contents heading-link" heading-name="递归阶乘（使用闭包）"><span class="tree-item-title">递归阶乘（使用闭包）</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>