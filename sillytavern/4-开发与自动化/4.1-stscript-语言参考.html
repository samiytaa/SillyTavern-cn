<!DOCTYPE html> <html lang="zh-cn"><head>
<title>4.1 STscript 语言参考</title>
<base href="../..">
<meta name="pathname" content="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html">
<meta name="description" content="SillyTavern - 4.1 STscript 语言参考">
<meta property="og:title" content="4.1 STscript 语言参考">
<meta property="og:description" content="SillyTavern - 4.1 STscript 语言参考">
<meta property="og:type" content="website">
<meta property="og:url" content="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html">
<meta property="og:image" content="app:/33fe05b72bfa0b1bb1e8d106bcc395c6d9c2/C:/Users/yunqi/Documents/Obsidian Vault/SillyTavern/img/20241222161559033.png?1734880794000">
<meta property="og:site_name" content="SillyTavern"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0"><meta charset="UTF-8"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="site-lib/rss.xml"><script async="" id="webpage-script" src="site-lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-wasm-script" src="site-lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="site-lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="site-lib/media/favicon.ico"><link rel="stylesheet" href="site-lib/styles/obsidian.css"><link rel="stylesheet" href="site-lib/styles/theme.css"><link rel="preload" href="site-lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="site-lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/main-styles.css"></noscript><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-vertical-spacing:1.3em;--sidebar-margin:12px}:root{background-color:#202124}.sidebar{height:100%;font-size:14px;z-index:10;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));position:relative;overflow:hidden;overflow:clip;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}#left-sidebar{left:0}#right-sidebar{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}.sidebar.floating{position:absolute}.sidebar .leaf-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .leaf-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}#left-sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}#right-sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar #left-sidebar-content,.sidebar #right-sidebar-content{contain:none!important;container-type:normal!important;animation:none!important}.sidebar:has(.leaf-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}#left-sidebar .sidebar-topbar{left:0;flex-direction:row}#right-sidebar .sidebar-topbar{right:0;flex-direction:row-reverse}#left-sidebar .topbar-content{margin-right:calc(2.3em + var(--sidebar-margin));flex-direction:row}#right-sidebar .topbar-content{margin-left:calc(2.3em + var(--sidebar-margin));flex-direction:row-reverse}.topbar-content{overflow:hidden visible;overflow:clip visible;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:2px!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}#left-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}#right-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.feature-title{margin-left:4px;text-transform:uppercase;letter-spacing:.06em;margin-top:.75em;margin-bottom:.75em}.feature-header{display:flex;align-items:center;padding-top:0;font-size:1em;padding-left:0}body.floating-sidebars .sidebar{position:absolute}body{transition:background-color var(--color-fade-speed) ease-in-out}#layout{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}#center-content{flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0!important;transition:opacity .2s ease-in-out;pointer-events:none}#center-content>.obsidian-document{padding-left:2em;padding-right:1em;margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}body #center-content>.obsidian-document>.markdown-preview-sizer{padding-bottom:80vh;width:100%;max-width:var(--line-width);flex-basis:var(--line-width);transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document>div{width:100%!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document:not([data-type=markdown]).embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}#center-content>.obsidian-document:not([data-type=markdown]).embed>*{max-width:100%;max-height:100%;object-fit:contain}:not(h1,h2,h3,h4,h5,h6):has(> :is(.math:not(.math-inline),table)){overflow-x:auto!important}#center-content>.obsidian-document:not([data-type=markdown]){overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.obsidian-document[data-type=attachment]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.obsidian-document[data-type=attachment]>*{outline:0;border:none;box-shadow:none}.obsidian-document[data-type=attachment] :is(img){max-width:90%;max-height:90%;object-fit:contain}.obsidian-document[data-type=attachment]>:is(audio){width:100%;max-width:min(90%,var(--line-width))}.obsidian-document[data-type=attachment]>:is(embed,iframe,video){width:100%;height:100%;max-width:100%;max-height:100%;object-fit:contain}.canvas-wrapper>:is(.header,.footer){z-index:100;position:absolute;display:flex;justify-content:center;flex-direction:column;width:100%;align-items:center}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){let e=document.querySelectorAll("link[itemprop='include']");for(const t of e){let e=t.getAttribute("href");try{let o="";if(e.startsWith("https:")||e.startsWith("http:")||"file:"!=window.location.protocol){const l=await fetch(e);if(!l.ok){console.log("Could not include file: "+e),t?.remove();continue}o=await l.text()}else{const t=document.getElementById(btoa(encodeURI(e)));if(t){const e=JSON.parse(decodeURI(atob(t.getAttribute("value")??"")));o=e?.data??""}}let l=document.createRange().createContextualFragment(o),n=Array.from(l.children);for(let e of n)e?.classList?.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e?.classList?.remove("hide")}),10);t.before(l),t.remove(),console.log("Included text: "+o),console.log("Included file: "+e)}catch(o){t?.remove(),console.log("Could not include file: "+e,o);continue}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script")));!function e(l){let n=o[l],c=l+1;n?(n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(c),l<o.length&&n.addEventListener("load",(()=>e(c)))):l<o.length?e(c):t()}(0)}</script></head><body class="publish css-settings-manager is-frameless is-hidden-frameless show-inline-title show-ribbon is-focused"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="parsed-feature-container" style="display: contents;"><link itemprop="include" href="site-lib/html/custom-head-content-content.html"></div><div id="layout"><div id="left-content" class="leaf" style="--sidebar-width: var(--sidebar-width-left);"><div id="left-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><div id="search-container"><div id="search-wrapper"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div aria-label="Clear search" id="search-clear-button"></div></div></div></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="left-sidebar-content" class="leaf-content"><link itemprop="include" href="site-lib/html/file-tree-content.html"></div></div><script defer="">let ls = document.querySelector("#left-sidebar"); ls.classList.toggle("is-collapsed", window.innerWidth < 768); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div></div><div id="center-content" class="leaf"><div class="obsidian-document markdown-preview-view markdown-rendered node-insert-event is-readable-line-width allow-fold-headings show-indentation-guide allow-fold-lists show-properties" data-type="markdown"><style id="MJX-CHTML-styles"></style><pre class="frontmatter language-yaml" tabindex="0" style="display: none;"><code class="language-yaml is-loaded"><span class="token key atrule">title</span><span class="token punctuation">:</span> STscript 语言参考</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre><div class="markdown-preview-sizer markdown-preview-section"><div class="header"><h1 class="page-title heading inline-title" id="4.1_STscript_语言参考_0">4.1 STscript 语言参考</h1><div class="data-bar"></div></div><div class="markdown-preview-pusher" style="width: 1px; height: 0.1px; margin-bottom: 0px;"></div><div class="el-h1"><h1 data-heading="STscript 语言参考" dir="auto" class="heading" id="STscript_语言参考_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>STscript 语言参考</h1></div><div class="el-h1"><h1 data-heading="什么是 STscript？" dir="auto" class="heading" id="什么是_STscript？_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>什么是 STscript？</h1></div><div class="el-p"><p dir="auto">STscript 是一种简单而强大的脚本语言，可用于扩展 SillyTavern 的功能，而无需深入的编码知识，使您能够：</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>创建迷你游戏或极速挑战</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>构建 AI 驱动的聊天洞察</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>释放您的创意并与他人分享<br>
STscript 基于斜杠命令引擎，利用命令批处理、数据管道、宏和变量。这些概念将在以下文档中详细介绍。</li>
</ul></div><div class="el-blockquote"><blockquote dir="auto">
<p>STscript 仍在积极开发中。 如果您计划使用其功能，建议使用 staging 分支。</p>
</blockquote></div><div class="el-h2"><h2 data-heading="安全预防" dir="auto" class="heading" id="安全预防_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>安全预防</h2></div><div class="el-p"><p dir="auto">强大的功能伴随着巨大的责任。请小心使用，并在执行脚本前仔细检查其内容。</p></div><div class="el-h1"><h1 data-heading="Hello, World!" dir="auto" class="heading" id="Hello,_World!_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Hello, World!</h1></div><div class="el-p"><p dir="auto">要运行您的第一个脚本，打开任何 SillyTavern 聊天框并在输入框中键入以下内容：</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/pass Hello, World! | /echo
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"></p><div alt="hello-world" src="img/20241222161559033.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="hello-world" src="img/20241222161559033.png" target="_self"></div><p dir="auto"></p></div><div class="el-p"><p dir="auto">您应该会看到顶部通知栏显示消息。现在让我们逐步分析这个脚本。</p></div><div class="el-p"><p dir="auto">一个脚本是由一组命令组成的，每个命令都以斜杠开头，可能包含命名和未命名的参数，并以命令分隔符字符</p></div><div class="el-p"><p dir="auto"><code>|</code> 结束。</p></div><div class="el-p"><p dir="auto">命令按顺序执行，彼此之间传递数据。</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/pass</code> 命令接受一个常量值 "Hello, World!" 作为未命名参数并将其写入管道。</li>
<li data-line="1" dir="auto"><code>/echo</code> 命令接收来自前一个命令的值并将其作为通知显示。</li>
</ol></div><div class="el-blockquote"><blockquote dir="auto">
<p>提示： 要查看所有可用命令的列表，请在聊天框中输入 /help slash。<br>
由于常量未命名参数和管道是可以互换的，我们可以简化这个脚本：</p>
</blockquote></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo Hello, World!
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h1"><h1 data-heading="用户输入" dir="auto" class="heading" id="用户输入_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>用户输入</h1></div><div class="el-p"><p dir="auto">现在让我们给脚本添加一些互动性。我们将从用户那里接受输入值并显示在通知中。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/input Enter your name |
/echo Hello, my name is {{pipe}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/input</code> 命令用于显示一个输入框，显示提示词（prompt）作为未命名参数，并将用户输入的值写入管道。</li>
<li data-line="1" dir="auto">因为 <code>/echo</code> 已经有一个未命名参数来设置输出模板，我们使用 <code>{{pipe}}</code> 宏来指定一个地方，将管道中的值渲染到这里。</li>
</ol></div><div class="el-p"><p dir="auto"></p><div alt="slim-input" src="img/20241222161559034.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="slim-input" src="img/20241222161559034.png" target="_self"></div><p dir="auto"></p></div><div class="el-p"><p dir="auto"></p><div alt="slim-output" src="img/20241222161559035.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="slim-output" src="img/20241222161559035.png" target="_self"></div><p dir="auto"></p></div><div class="el-h2"><h2 data-heading="其他输入/输出命令" dir="auto" class="heading" id="其他输入/输出命令_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>其他输入/输出命令</h2></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><code>/popup (text)</code> — 显示一个阻塞弹出框，支持轻量 HTML 格式化，例如：<code>/popup &lt;font color=red&gt;I'm red!&lt;/font&gt;</code>。</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><code>/setinput (text)</code> — 替换用户输入框中的内容为提供的文本。</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><code>/speak voice="name" (text)</code> — 使用所选的 TTS 引擎并通过角色语音播放文本，例如：<code>/speak name="Donald Duck" Quack!</code>。</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span><code>/buttons labels=["a","b"] (text)</code> — 显示一个阻塞弹出框，带有指定的文本和按钮标签。<code>labels</code> 必须是一个 JSON 格式的字符串数组或包含此数组的变量名。返回被点击的按钮标签，或者如果取消则返回空字符串。文本支持轻量 HTML 格式化。</li>
</ul></div><div class="el-h3"><h3 data-heading="`/popup` 和 `/input` 的额外参数" dir="auto" class="heading" id="`/popup`_和_`/input`_的额外参数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><code>/popup</code> 和 <code>/input</code> 的额外参数</h3></div><div class="el-p"><p dir="auto"><code>/popup</code> 和 <code>/input</code> 支持以下额外的命名参数：</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><code>large=on/off</code> - 增加弹出框的垂直大小，默认：<code>off</code>。</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><code>wide=on/off</code> - 增加弹出框的水平大小，默认：<code>off</code>。</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><code>okButton=string</code> - 自定义"确认"按钮的文本，默认：<code>Ok</code>。</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span><code>rows=number</code> - （仅适用于 <code>/input</code>）增加输入框的行数，默认：1。<br>
示例：</li>
</ul></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/popup large=on wide=on okButton="Accept" Please accept our terms and conditions....
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="`/echo` 的参数" dir="auto" class="heading" id="`/echo`_的参数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><code>/echo</code> 的参数</h3></div><div class="el-p"><p dir="auto"><code>/echo</code> 支持以下值作为额外的 <code>severity</code> 参数，用于设置显示消息的样式。</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><code>warning</code></li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><code>error</code></li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><code>info</code>（默认）</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span><code>success</code><br>
示例：</li>
</ul></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo severity=error Something really bad happened.
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h1"><h1 data-heading="变量" dir="auto" class="heading" id="变量_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>变量</h1></div><div class="el-p"><p dir="auto">变量用于在脚本中存储和操作数据，可以通过命令或宏进行操作。变量可以是以下几种类型：</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>本地变量 — 保存于当前聊天的元数据中，仅在该聊天中唯一。</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>全局变量 — 保存于 <code>settings.json</code> 中，存在于整个应用中。</li>
</ul></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/getvar name</code> 或 <code>{{getvar::name}}</code> — 获取本地变量的值。</li>
<li data-line="1" dir="auto"><code>/setvar key=name value</code> 或 <code>{{setvar::name::value}}</code> — 设置本地变量的值。</li>
<li data-line="2" dir="auto"><code>/addvar key=name increment</code> 或 <code>{{addvar::name::increment}}</code> — 将 <code>increment</code> 的值添加到本地变量。</li>
<li data-line="3" dir="auto"><code>/incvar name</code> 或 <code>{{incvar::name}}</code> — 将本地变量的值增加 1。</li>
<li data-line="4" dir="auto"><code>/decvar name</code> 或 <code>{{decvar::name}}</code> — 将本地变量的值减少 1。</li>
<li data-line="5" dir="auto"><code>/getglobalvar name</code> 或 <code>{{getglobalvar::name}}</code> — 获取全局变量的值。</li>
<li data-line="6" dir="auto"><code>/setglobalvar key=name</code> 或 <code>{{setglobalvar::name::value}}</code> — 设置全局变量的值。</li>
<li data-line="7" dir="auto"><code>/addglobalvar key=name</code> 或 <code>{{addglobalvar::name:increment}}</code> — 将 <code>increment</code> 的值添加到全局变量。</li>
<li data-line="8" dir="auto"><code>/incglobalvar name</code> 或 <code>{{incglobalvar::name}}</code> — 将全局变量的值增加 1。</li>
<li data-line="9" dir="auto"><code>/decglobalvar name</code> 或 <code>{{decglobalvar::name}}</code> — 将全局变量的值减少 1。</li>
<li data-line="10" dir="auto"><code>/flushvar name</code> — 删除本地变量的值。</li>
<li data-line="11" dir="auto"><code>/flushglobalvar name</code> — 删除全局变量的值。</li>
</ol></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>初次使用时，未定义的变量的默认值为一个空字符串或零（如果是 <code>/addvar</code>、<code>/incvar</code>、<code>/decvar</code> 命令的参数）。</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><code>/addvar</code> 命令中的增量操作如果能够将增量和变量值转换为数字，则执行加法或减法运算，否则执行字符串连接。</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>如果命令参数接受变量名，并且存在同名的本地和全局变量，则优先使用 <em>本地变量</em>。</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>所有的 <em>斜杠命令</em> 会将结果值写入管道，以便后续命令使用。</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>对于 <em>宏</em>，只有 "get"、"inc" 和 "dec" 类型的宏会返回值，"add" 和 "set" 会被替换为空字符串。<br>
现在，考虑以下示例：</li>
</ul></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/input What do you want to generate? |
/setvar key=SDinput |
/echo Requesting an image of {{getvar::SDinput}} |
/getvar SDinput |
/imagine
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">用户的输入值被保存在本地变量 <code>SDinput</code> 中。</li>
<li data-line="1" dir="auto"><code>getvar</code> 宏被用来在 <code>/echo</code> 命令中显示这个值。</li>
<li data-line="2" dir="auto"><code>getvar</code> 命令用来获取变量的值，并将其传递给下一个命令。</li>
<li data-line="3" dir="auto">这个值被传递给 <code>/imagine</code> 命令（图像生成插件），作为输入提示词（prompt）。<br>
由于变量在脚本执行期间被保存，并且不会在执行间被清除，您可以在其他脚本中引用该变量，它将解析为脚本执行时的相同值。如果要确保值会被丢弃，可以在脚本中添加<br>
<code>/flushvar</code> 命令。</li>
</ol></div><div class="el-h2"><h2 data-heading="数组和对象" dir="auto" class="heading" id="数组和对象_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>数组和对象</h2></div><div class="el-p"><p dir="auto">变量值可以包含 JSON 格式化的数组或键值对对象。</p></div><div class="el-p"><p dir="auto">示例：</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>
<p>数组：<code>["apple","banana","orange"]</code></p>
</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>
<p>对象：<code>{"fruits":["apple","banana","orange"]}</code><br>
可以对命令进行以下修改，以便操作这些类型的变量：</p>
</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>
<p><code>/len</code> 命令获取数组的元素数量。</p>
</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>
<p>可以在 <code>/getvar</code> 或 <code>/setvar</code> 命令中使用 <code>index=number/string</code> 作为命名参数来获取或设置数组的子值，或获取对象的键值。</p>
<ul class="has-list-bullet">
<li data-line="6" dir="auto"><span class="list-bullet"></span>如果数组变量使用数字索引且该索引不存在，变量会被创建为一个空数组 <code>[]</code>。</li>
<li data-line="7" dir="auto"><span class="list-bullet"></span>如果对象变量使用字符串索引且该索引不存在，变量会被创建为一个空对象 <code>{}</code>。</li>
</ul>
</li>
<li data-line="8" dir="auto"><span class="list-bullet"></span>
<p><code>/addvar</code> 和 <code>/addglobalvar</code> 命令支持将新值推送到数组类型的变量。</p>
</li>
</ul></div><div class="el-h1"><h1 data-heading="流程控制 - 条件语句" dir="auto" class="heading" id="流程控制_-_条件语句_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>流程控制 - 条件语句</h1></div><div class="el-p"><p dir="auto">您可以使用 <code>/if</code> 命令创建条件表达式，根据定义的规则分支执行。</p></div><div class="el-p"><p dir="auto"><code>/if left=valueA right=valueB rule=comparison else="(false command)" "(true command)"</code></p></div><div class="el-p"><p dir="auto">我们来看看以下示例：</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/input What's your favorite drink? |
/if left={{pipe}} right="black tea" rule=eq else="/echo You shall not pass \\\\\\\\| /abort" "/echo Welcome to the club, \\\\\\\\{\\\\\\\\{user\\\\\\\\}\\\\\\\\}"
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">这个脚本根据用户输入的值判断并显示不同的消息。</p></div><div class="el-h2"><h2 data-heading="`/if` 参数" dir="auto" class="heading" id="`/if`_参数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><code>/if</code> 参数</h2></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">
<p><code>left</code> 是第一个操作数，我们称其为 A。</p>
</li>
<li data-line="1" dir="auto">
<p><code>right</code> 是第二个操作数，我们称其为 B。</p>
</li>
<li data-line="2" dir="auto">
<p><code>rule</code> 是应用于操作数的运算符。</p>
</li>
<li data-line="3" dir="auto">
<p><code>else</code> 是可选的字符串，表示如果布尔比较结果为假时执行的子命令。</p>
</li>
<li data-line="4" dir="auto">
<p>未命名的参数是布尔比较结果为真时执行的子命令。<br>
操作数值的评估顺序如下：</p>
</li>
<li data-line="7" dir="auto">
<p>数字字面量</p>
</li>
<li data-line="8" dir="auto">
<p>本地变量名</p>
</li>
<li data-line="9" dir="auto">
<p>全局变量名</p>
</li>
<li data-line="10" dir="auto">
<p>字符串字面量<br>
命名参数的字符串可以用引号转义，以允许多单词字符串，转义后的引号会被丢弃。</p>
</li>
</ol></div><div class="el-h2"><h2 data-heading="布尔运算" dir="auto" class="heading" id="布尔运算_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>布尔运算</h2></div><div class="el-p"><p dir="auto">支持以下布尔比较规则，操作结果为布尔值（真或假）：</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>eq</code>（等于）=&gt; A = B</li>
<li data-line="1" dir="auto"><code>neq</code>（不等于）=&gt; A != B</li>
<li data-line="2" dir="auto"><code>lt</code>（小于）=&gt; A &lt; B</li>
<li data-line="3" dir="auto"><code>gt</code>（大于）=&gt; A &gt; B</li>
<li data-line="4" dir="auto"><code>lte</code>（小于或等于）=&gt; A &lt;= B</li>
<li data-line="5" dir="auto"><code>gte</code>（大于或等于）=&gt; A &gt;= B</li>
<li data-line="6" dir="auto"><code>not</code>（否定）=&gt; !A</li>
<li data-line="7" dir="auto"><code>in</code>（包含子字符串）=&gt; A 包含 B，忽略大小写</li>
<li data-line="8" dir="auto"><code>nin</code>（不包含子字符串）=&gt; A 不包含 B，忽略大小写</li>
</ol></div><div class="el-h2"><h2 data-heading="子命令" dir="auto" class="heading" id="子命令_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>子命令</h2></div><div class="el-p"><p dir="auto">子命令是一个包含多个斜杠命令的字符串。</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">
<p>为了在子命令中使用命令批处理，命令分隔符字符应转义（见下文）。</p>
</li>
<li data-line="1" dir="auto">
<p>由于宏值在条件进入时被执行，而不是在子命令执行时，因此可以转义宏，以延迟它们的执行时间。</p>
</li>
<li data-line="2" dir="auto">
<p>子命令执行的结果将被传递给 <code>/if</code> 后的命令。</p>
</li>
<li data-line="3" dir="auto">
<p><code>/abort</code> 命令会中止脚本执行。</p>
<p><code>/if</code> 命令也可以作为三元运算符使用。以下示例将在变量 <code>a</code> 等于 5 时，将 "true" 字符串传递给下一个命令，否则传递 "false" 字符串。</p>
</li>
</ol></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/if left=a right=5 rule=eq else="/pass false" "/pass true" |
/echo
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h1"><h1 data-heading="转义序列" dir="auto" class="heading" id="转义序列_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>转义序列</h1></div><div class="el-h2"><h2 data-heading="宏" dir="auto" class="heading" id="宏_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>宏</h2></div><div class="el-p"><p dir="auto">宏的转义方法与以前一样。不过，在使用闭包时，通常需要转义宏的次数会少得多。你只需转义两个大括号的开头，或者同时转义开头和结尾的大括号对。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo \\\\\\\\{\\\\\\\\{char}} |
/echo \\\\\\\\{\\\\\\\\{char\\\\\\\\}\\\\\\\\}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="管道符" dir="auto" class="heading" id="管道符_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>管道符</h2></div><div class="el-p"><p dir="auto">在闭包中，管道符不需要转义（当用作命令分隔符时）。在其他地方，如果你希望使用字面量管道符而不是命令分隔符，必须进行转义。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo title="a\\\\\\\\|b" c\\\\\\\\|d |
/echo title=a\\\\\\\\|b c\\\\\\\\|d |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">启用解析器标志 <code>STRICT_ESCAPING</code> 后，你不需要在引号值中转义管道符。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/parser-flag STRICT_ESCAPING |
/echo title="a|b" c\\\\\\\\|d |
/echo title=a\\\\\\\\|b c\\\\\\\\|d |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="引号" dir="auto" class="heading" id="引号_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>引号</h2></div><div class="el-p"><p dir="auto">要在引号值内使用字面量的引号字符，必须进行转义。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo title="a \\\\\\\\"b\\\\\\\\" c" d "e" f
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="空格" dir="auto" class="heading" id="空格_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>空格</h2></div><div class="el-p"><p dir="auto">要在命名参数的值中使用空格，你必须用引号将值括起来，或者转义空格字符。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo title="a b" c d |
/echo title=a\\\\\\\\ b c d
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="闭包定界符" dir="auto" class="heading" id="闭包定界符_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>闭包定界符</h2></div><div class="el-p"><p dir="auto">如果你想使用标记闭包开始或结束的字符组合，则需要用一个反斜杠转义该序列。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo \\\\\\\\{: |
/echo \\\\\\\\:}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h1"><h1 data-heading="管道断开符" dir="auto" class="heading" id="管道断开符_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>管道断开符</h1></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">||
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">为了防止前一个命令的输出自动作为未命名参数传递给下一个命令，可以在两个命令之间放置双管道符。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo we don't want to pass this on ||
/world
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h1"><h1 data-heading="闭包" dir="auto" class="heading" id="闭包_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>闭包</h1></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">{: ... :}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">闭包（块语句、匿名函数、匿名函数等的说法）是一系列命令，它们被包裹在 <code>{:</code> 和 <code>:}</code> 之间，只有在执行该部分代码时才会被评估。</p></div><div class="el-h2"><h2 data-heading="子命令" dir="auto" class="heading" id="子命令_1"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>子命令</h2></div><div class="el-p"><p dir="auto">闭包使得使用子命令变得更加容易，且不再需要转义管道符和宏。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">// 没有闭包的 if |
/if left=1 rule=eq right=1
    else="
        /echo not equal \\\\\\\\|
        /return 0
    "
    /echo equal \\\\\\\\|
    /return \\\\\\\\{\\\\\\\\{pipe\\\\\\\\}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">// 有闭包的 if |
/if left=1 rule=eq right=1
    else={:
        /echo not equal |
        /return 0
    :}
    {:
        /echo equal |
        /return {{pipe}}
    :}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="作用域" dir="auto" class="heading" id="作用域_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>作用域</h2></div><div class="el-p"><p dir="auto">闭包有自己的作用域，并且支持作用域变量。作用域变量通过 <code>/let</code> 声明，使用 <code>/var</code> 设置和获取其值。另一种获取作用域变量的方法是使用 <code>{{var::}}</code> 宏。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let x |
/let y 2 |
/var x 1 |
/var y |
/echo x is {{var::x}} and y is {{pipe}}.
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">在闭包内，你可以访问该闭包内或其父闭包中声明的所有变量。你不能访问闭包后代中声明的变量。</p></div><div class="el-p"><p dir="auto">如果在闭包中声明了与父闭包中同名的变量，你将无法访问父闭包中的变量。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let x this is root x |
/let y this is root y |
/return {:
    /echo called from level-1: x is "{{var::x}}" and y is "{{var::y}}" |
    /delay 500 |
    /let x this is level-1 x |
    /echo called from level-1: x is "{{var::x}}" and y is "{{var::y}}" |
    /delay 500 |
    /return {:
        /echo called from level-2: x is "{{var::x}}" and y is "{{var::y}}" |
        /let x this is level-2 x |
        /echo called from level-2: x is "{{var::x}}" and y is "{{var::y}}" |
        /delay 500
    :}()
:}() |
/echo called from root: x is "{{var::x}}" and y is "{{var::y}}"
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="命名闭包" dir="auto" class="heading" id="命名闭包_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>命名闭包</h2></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let x {: ... :} | /:x
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">闭包可以被分配给变量（仅限作用域变量），以便稍后调用或作为子命令使用。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let myClosure {:
    /echo this is my closure
:} |
/:myClosure
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let myClosure {:
    /echo this is my closure |
    /delay 500
:} |
/times 3 {{var::myClosure}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><code>/:</code> 也可以用来执行快速回复，它是 <code>/run</code> 的快捷方式。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/:QrSetName.QrButtonLabel |
/run QrSetName.QrButtonLabel
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="闭包参数" dir="auto" class="heading" id="闭包参数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>闭包参数</h2></div><div class="el-p"><p dir="auto">命名闭包可以像斜杠命令一样接受命名参数，参数可以有默认值。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let myClosure {: a=1 b=
    /echo a is {{var::a}} and b is {{var::b}}
:} |
/:myClosure b=10
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="闭包和管道参数" dir="auto" class="heading" id="闭包和管道参数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>闭包和管道参数</h2></div><div class="el-p"><p dir="auto">父闭包的管道值不会自动注入到子闭包的第一个命令的未命名参数中。</p></div><div class="el-p"><p dir="auto">你仍然可以通过</p></div><div class="el-p"><p dir="auto"><code>{{pipe}}</code> 显式引用父闭包的管道值，但如果你让子闭包的第一个命令的未命名参数为空值，管道值不会自动注入。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/* 以前这会尝试将模型改为 "foo"，因为外部 /echo 的值 "foo"
   被注入到了内部 /model 命令。
   现在它只是简单地回显当前模型，而不尝试修改它。
*|
/echo foo |
/times 2 {:
	/model |
	/echo |
:} |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/* 你仍然可以通过显式使用 {{pipe}} 宏来恢复以前的行为。
*|
/echo foo |
/times 2 {:
	/model {{pipe}} |
	/echo |
:} |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="立即执行闭包" dir="auto" class="heading" id="立即执行闭包_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>立即执行闭包</h2></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">{: ... :}()
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">闭包可以立即执行，意味着它们会被替换为返回值。这对于在没有显式支持闭包的地方非常有用，或者可以缩短一些需要多个中间变量的命令。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">// 没有闭包的简单长度比较 |
/len foo |
/var lenOfFoo {{pipe}} |
/len bar |
/var lenOfBar {{pipe}} |
/if left={{var::lenOfFoo}} rule=eq right={{var:lenOfBar}} /echo yay!
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">// 使用立即执行闭包进行相同的比较 |
/if left={:/len foo:}() rule=eq right={:/len bar:}() /echo yay!
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">除了运行保存在作用域变量中的命名闭包外，<code>/run</code> 命令也可以用来立即执行闭包。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/run {:
	/add 1 2 3 4 |
:} |
/echo |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h1"><h1 data-heading="注释" dir="auto" class="heading" id="注释_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>注释</h1></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">// ... | /# ...
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">注释是对脚本代码的可读说明或注解，注释不会中断管道。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">// this is a comment |
/echo foo |
/# this is also a comment
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="块注释" dir="auto" class="heading" id="块注释_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>块注释</h2></div><div class="el-p"><p dir="auto">块注释可用于快速注释掉多条命令。它们不会终止管道。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/echo foo |
/*
/echo bar |
/echo foobar |
*|
/echo foo again |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h1"><h1 data-heading="流程控制" dir="auto" class="heading" id="流程控制_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>流程控制</h1></div><div class="el-h2"><h2 data-heading="循环：`/while` 和 `/times`" dir="auto" class="heading" id="循环：`/while`_和_`/times`_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>循环：<code>/while</code> 和 <code>/times</code></h2></div><div class="el-p"><p dir="auto">如果你需要在某个条件满足时运行一些命令，可以使用 <code>/while</code> 命令。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/while left=valueA right=valueB rule=operation guard=on "commands"
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">每一步，循环都会比较变量 A 和变量 B 的值，如果条件为真，则执行被引号括起来的任何有效斜杠命令，否则退出循环。该命令不会写入输出管道。</p></div><div class="el-h3"><h3 data-heading="`/while` 的参数" dir="auto" class="heading" id="`/while`_的参数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><code>/while</code> 的参数</h3></div><div class="el-p"><p dir="auto"><strong>可用的布尔比较、变量处理、字面值和子命令集与</strong> <code>**/if**</code> <strong>命令相同。</strong><br>
可选的<br>
<code>guard</code> 命名参数（默认为 <code>on</code>）用于防止死循环，将迭代次数限制为 100 次。要禁用并允许死循环，请设置 <code>guard=off</code><br>
。<br>
该示例将 1 加到<br>
<code>i</code> 的值，直到其达到 10，然后输出结果值（在本例中为 10）。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/setvar key=i 0 |
/while left=i right=10 rule=lt "/addvar key=i 1" |
/echo {{getvar::i}} |
/flushvar i
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h3"><h3 data-heading="`/times` 的参数" dir="auto" class="heading" id="`/times`_的参数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><code>/times</code> 的参数</h3></div><div class="el-p"><p dir="auto">该命令会重复指定的子命令若干次。</p></div><div class="el-p"><p dir="auto"><code>/times (repeats) "(command)"</code> —— 任何有效的斜杠命令将重复若干次，例如 <code>/setvar key=i 1 | /times 5 "/addvar key=i 1"</code> 将 <code>i</code> 增加 1 5 次。</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><code>{{timesIndex}}</code> 会被替换为迭代次数（从零开始），例如 <code>/times 4 "/echo {{timesIndex}}"</code> 会依次回显数字 0 到 4。</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>循环默认最多执行 100 次，传递 <code>guard=off</code> 可禁用此限制。</li>
</ul></div><div class="el-h2"><h2 data-heading="跳出循环和闭包" dir="auto" class="heading" id="跳出循环和闭包_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>跳出循环和闭包</h2></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/break |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><code>/break</code> 命令可用于提前跳出循环（<code>/while</code> 或 <code>/times</code>）或闭包。<code>/break</code> 的未命名参数可以用于传递不同于当前管道的值。</p></div><div class="el-p"><p dir="auto"><code>/break</code> 目前在以下命令中实现：</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><code>/while</code> - 提前退出循环</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><code>/times</code> - 提前退出循环</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><code>/run</code>（带闭包或通过变量的闭包） - 提前退出闭包</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span><code>/:</code>（带闭包） - 提前退出闭包</li>
</ul></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/times 10 {:
	/echo {{timesIndex}}
	/delay 500 |
	/if left={{timesIndex}} rule=gt right=3 {:
		/break
	:} |
:} |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let x {: iterations=2
	/if left={{var::iterations}} rule=gt right=10 {:
		/break too many iterations! |
	:} |
	/times {{var::iterations}} {:
		/delay 500 |
		/echo {{timesIndex}} |
	:} |
:} |
/:x iterations=30 |
/echo the final result is: {{pipe}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/run {:
	/break 1 |
	/pass 2 |
:} |
/echo pipe will be one: {{pipe}} |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/let x {:
	/break 1 |
	/pass 2 |
:} |
/:x |
/echo pipe will be one: {{pipe}} |
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h1"><h1 data-heading="数学运算" dir="auto" class="heading" id="数学运算_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>数学运算</h1></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span>以下所有操作都接受一系列数字或变量名并将结果输出到管道。</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>无效操作（如除以零）以及导致 NaN 值或无穷大的运算返回零。</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>乘法、加法、最小值和最大值可以接受多个参数，参数之间用空格分隔。</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>减法、除法、指数和取余操作仅接受两个参数，参数之间用空格分隔。</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>正弦、余弦、自然对数、平方根、绝对值和四舍五入操作仅接受一个参数。<br>
<strong>操作列表：</strong></li>
</ul></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/add (a b c d)</code> – 对一组值进行加法运算，例如 <code>/add 10 i 30 j</code></li>
<li data-line="1" dir="auto"><code>/mul (a b c d)</code> – 对一组值进行乘法运算，例如 <code>/mul 10 i 30 j</code></li>
<li data-line="2" dir="auto"><code>/max (a b c d)</code> – 返回一组值中的最大值，例如 <code>/max 1 0 4 k</code></li>
<li data-line="3" dir="auto"><code>/min (a b c d)</code> – 返回一组值中的最小值，例如 <code>/min 5 4 i 2</code></li>
<li data-line="4" dir="auto"><code>/sub (a b)</code> – 对两个值进行减法运算，例如 <code>/sub i 5</code></li>
<li data-line="5" dir="auto"><code>/div (a b)</code> – 对两个值进行除法运算，例如 <code>/div 10 i</code></li>
<li data-line="6" dir="auto"><code>/mod (a b)</code> – 对两个值进行取余运算，例如 <code>/mod i 2</code></li>
<li data-line="7" dir="auto"><code>/pow (a b)</code> – 对两个值进行指数运算，例如 <code>/pow i 2</code></li>
<li data-line="8" dir="auto"><code>/sin (a)</code> – 对一个值进行正弦运算，例如 <code>/sin i</code></li>
<li data-line="9" dir="auto"><code>/cos (a)</code> – 对一个值进行余弦运算，例如 <code>/cos i</code></li>
<li data-line="10" dir="auto"><code>/log (a)</code> – 对一个值进行自然对数运算，例如 <code>/log i</code></li>
<li data-line="11" dir="auto"><code>/abs (a)</code> – 对一个值进行绝对值运算，例如 <code>/abs -10</code></li>
<li data-line="12" dir="auto"><code>/sqrt (a)</code>– 对一个值进行平方根运算，例如 <code>/sqrt 9</code></li>
<li data-line="13" dir="auto"><code>/round (a)</code> – 对一个值进行四舍五入运算，例如 <code>/round 3.14</code></li>
<li data-line="14" dir="auto"><code>/rand (round=round|ceil|floor from=number=0 to=number=1)</code> – 返回一个在 from 和 to 之间的随机数，例如 <code>/rand</code> 或 <code>/rand 10</code> 或 <code>/rand from=5 to=10</code>。范围是包含端点的。返回的值将包含小数部分。使用<code>round</code>参数可以返回整数值，例如 <code>/rand round=ceil</code> 向上取整，<code>round=floor</code> 向下取整，<code>round=round</code> 四舍五入。</li>
</ol></div><div class="el-h2"><h2 data-heading="示例 1：计算半径为 50 的圆的面积。" dir="auto" class="heading" id="示例_1：计算半径为_50_的圆的面积。_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例 1：计算半径为 50 的圆的面积。</h2></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/setglobalvar key=PI 3.1415 |
/setvar key=r 50 |
/mul r r PI |
/round |
/echo 圆的面积: {{pipe}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="示例 2：计算 5 的阶乘。" dir="auto" class="heading" id="示例_2：计算_5_的阶乘。_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例 2：计算 5 的阶乘。</h2></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/setvar key=input 5 |
/setvar key=i 1 |
/setvar key=product 1 |
/while left=i right=input rule=lte "/mul product i \\\\\\\\| /setvar key=product \\\\\\\\| /addvar key=i 1" |
/getvar product |
/echo {{getvar::input}}的阶乘: {{pipe}} |
/flushvar input |
/flushvar i |
/flushvar product
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h1"><h1 data-heading="使用 LLM（大语言模型）" dir="auto" class="heading" id="使用_LLM（大语言模型）_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>使用 LLM（大语言模型）</h1></div><div class="el-p"><p dir="auto">脚本可以通过以下命令向当前连接的 LLM API 发出请求：</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><code>/gen (prompt)</code> — 使用提供的提示词生成文本，按照选定角色生成，包括聊天消息。</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><code>/genraw (prompt)</code> — 使用纯提示词生成文本，忽略当前角色和聊天。</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><code>/trigger</code> — 触发正常生成（相当于点击“发送”按钮）。如果是群聊，可以选择提供一个 1 基的组员索引或角色名，其他情况下则按群设置触发一次群聊轮次。</li>
</ul></div><div class="el-h2"><h2 data-heading="`/gen` 和 `/genraw` 的参数" dir="auto" class="heading" id="`/gen`_和_`/genraw`_的参数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><code>/gen</code> 和 <code>/genraw</code> 的参数</h2></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/genraw lock=on/off stop=[] instruct=on/off (prompt)
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><code>lock</code> — 可以设置为 <code>on</code> 或 <code>off</code>。指定在生成进行时是否禁止用户输入。默认：<code>off</code>。</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><code>stop</code> — JSON 序列化数组的字符串。为此生成提供自定义停止字符串（如果 API 支持）。默认：无。</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><code>instruct</code>（仅对<code>/genraw</code>有效）— 可以设置为 <code>on</code> 或 <code>off</code>。允许在输入提示词时使用指令格式（如果 API 支持并且启用了指令模式）。设置为<code>off</code>可以强制使用纯提示词。默认：<code>on</code>。</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span><code>as</code>（对于文本补全 API）— 可以设置为 <code>system</code>（默认）或 <code>char</code>。定义最后的提示行格式。<code>char</code>将使用角色名称，<code>system</code>则使用中立格式。<br>
生成的文本将通过管道传递到下一个命令，并可以保存到变量或通过输入输出能力显示：</li>
</ul></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/genraw 写一条来自克苏鲁的幽默信息，谈论征服世界。使用表情符号。 |
/popup &lt;h3&gt;克苏鲁说:&lt;/h3&gt;&lt;div&gt;{{pipe}}&lt;/div&gt;
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"></p><div alt="image 10|image 10.png" src="img/20241222161559036.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="image 10|image 10.png" src="img/20241222161559036.png" target="_self"></div><p dir="auto"></p></div><div class="el-h1"><h1 data-heading="提示词注入" dir="auto" class="heading" id="提示词注入_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>提示词注入</h1></div><div class="el-p"><p dir="auto">脚本可以添加自定义的 LLM 提示词注入，基本相当于无限制的作者注释。</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><code>/inject (text)</code> — 将任何文本插入到当前聊天的正常 LLM 提示词中，并需要一个唯一的标识符。保存到聊天元数据。</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><code>/listinjects</code> — 显示当前聊天中由脚本添加的所有提示词注入。</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><code>/flushinjects</code> — 删除当前聊天中由脚本添加的所有提示词注入。</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span><code>/note (text)</code> — 设置当前聊天的作者注释值。保存到聊天元数据。</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span><code>/interval</code> — 设置当前聊天的作者注释插入间隔。</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span><code>/depth</code> — 设置当前聊天的作者注释插入深度。</li>
<li data-line="6" dir="auto"><span class="list-bullet"></span><code>/position</code> — 设置当前聊天的作者注释插入位置。</li>
</ul></div><div class="el-h2"><h2 data-heading="`/inject` 的参数" dir="auto" class="heading" id="`/inject`_的参数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><code>/inject</code> 的参数</h2></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/inject id=IdGoesHere position=chat depth=4 我的提示词注入
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><code>id</code> — 一个标识符字符串或变量引用。后续调用相同 ID 的<code>/inject</code>将覆盖之前的文本注入。<strong>必须提供该参数。</strong></li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><code>position</code> — 设置插入的位置。默认：<code>after</code>。可能的值：
<ul class="has-list-bullet">
<li data-line="2" dir="auto"><span class="list-bullet"></span><code>after</code>：在主提示词之后。</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span><code>before</code>：在主提示词之前。</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span><code>chat</code>：插入到聊天中。</li>
</ul>
</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span><code>depth</code> — 设置插入的深度，0 表示插入到最后一条消息之后，1 表示插入到最后一条消息之前，依此类推。默认：4。</li>
<li data-line="6" dir="auto"><span class="list-bullet"></span>未命名的参数是要插入的文本。如果为空字符串，则会删除该标识符之前的值。</li>
</ul></div><div class="el-h1"><h1 data-heading="访问聊天消息" dir="auto" class="heading" id="访问聊天消息_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>访问聊天消息</h1></div><div class="el-h2"><h2 data-heading="读取消息" dir="auto" class="heading" id="读取消息_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>读取消息</h2></div><div class="el-p"><p dir="auto">您可以使用 <code>/messages</code> 命令访问当前选定聊天中的消息。</p></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/messages names=on/off start-finish
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><code>names</code> 参数用于指定是否希望包含角色名称，默认值：<code>on</code>。</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span>未命名参数接受消息索引或范围，格式为 <code>start-finish</code>。范围是包含端点的！</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>如果范围无法满足（例如提供了无效索引或请求的消息数量超出了存在的消息数量），则返回空字符串。</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>隐藏的消息（由鬼魂图标标记）将被排除在输出之外。</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>若要了解最新消息的索引，请使用 <code>{{lastMessageId}}</code>，<code>{{lastMessage}}</code> 将获取最新的消息本身。<br>
要计算范围的起始索引，例如，当您需要获取最后 N 条消息时，可以使用变量减法。 以下示例将获取最近的 3 条消息：</li>
</ul></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/setvar key=start {{lastMessageId}} |
/addvar key=start -2 |
/messages names=off {{getvar::start}}-{{lastMessageId}} |
/setinput
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="发送消息" dir="auto" class="heading" id="发送消息_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>发送消息</h2></div><div class="el-p"><p dir="auto">脚本可以以用户、角色、人物、或中立叙述者身份发送消息，也可以添加评论。</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">
<p><code>/send (text)</code> — 以当前选定的身份添加一条消息。</p>
</li>
<li data-line="1" dir="auto">
<p><code>/sendas name=charname (text)</code> — 以任何角色的身份添加消息，<code>name</code> 参数是必需的。使用 <code>{{char}}</code> 宏来发送当前角色的消息。</p>
</li>
<li data-line="2" dir="auto">
<p><code>/sys (text)</code> — 以中立叙述者身份添加消息，该消息不属于用户或角色。显示的名称纯粹是装饰性，可以使用 <code>/sysname</code> 命令自定义。</p>
</li>
<li data-line="3" dir="auto">
<p><code>/comment (text)</code> — 添加一条隐藏评论，该评论在聊天中显示，但不会出现在提示词中。</p>
</li>
<li data-line="4" dir="auto">
<p><code>/addswipe (text)</code> — 为最后的角色消息添加一个滑动动作。<br>
不能对用户或隐藏的消息添加滑动动作。 6.<br>
<code>/hide (message id or range)</code> — 根据提供的消息索引或范围（<code>start-finish</code>格式）隐藏一条或多条消息。 7. <code>/unhide (message id or range)</code> — 根据提供的消息索引或范围（<code>start-finish</code>格式）恢复一条或多条消息。</p>
<p><code>/send</code>、<code>/sendas</code>、<code>/sys</code> 和 <code>/comment</code> 命令都可以选择性地接受 <code>at</code> 参数，指定消息插入的确切位置。默认情况下，新的消息会插入到聊天日志的末尾。</p>
<p>以下将用户消息插入到聊天历史的开头：</p>
</li>
</ol></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/send at=0 我使用Linux。
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="删除消息" dir="auto" class="heading" id="删除消息_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>删除消息</h2></div><div class="el-p"><p dir="auto"><strong>这些命令是潜在的破坏性操作，没有“撤销”功能。请检查</strong> <code>**/backups/**</code> <strong>文件夹，避免误删重要内容。</strong></p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/cut (message id or range)</code> — 根据提供的消息索引或范围（<code>start-finish</code>格式）剪切一条或多条消息。</li>
<li data-line="1" dir="auto"><code>/del (number)</code> — 删除最近的 N 条消息。</li>
<li data-line="2" dir="auto"><code>/delswipe (1-based swipe id)</code> — 根据提供的 1 基索引删除最后一条角色消息中的滑动动作。</li>
<li data-line="3" dir="auto"><code>/delname (character name)</code> — 删除当前聊天中所有属于指定角色的消息。</li>
<li data-line="4" dir="auto"><code>/delchat</code> — 删除当前聊天。</li>
</ol></div><div class="el-h1"><h1 data-heading="世界书（World Info）命令" dir="auto" class="heading" id="世界书（World_Info）命令_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>世界书（World Info）命令</h1></div><div class="el-p"><p dir="auto">世界书（也称为 Lorebook）是一个高度实用的工具，用于动态地将数据插入到提示词（prompt）中。请参见专门的页面以获取更详细的说明：<a data-href="2.7 世界书（World Info）" href="sillytavern/2-使用指南/2.7-世界书（world-info）.html#_0" class="internal-link" target="_self" rel="noopener nofollow">2.7 世界书（World Info）</a>。</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/getchatbook</code> – 获取与当前聊天绑定的世界书文件的名称，如果未绑定，则创建一个新文件，并将其传递给后续命令。</li>
<li data-line="1" dir="auto"><code>/findentry file=bookName field=fieldName [text]</code> – 使用模糊匹配查找指定文件中字段值与提供的文本（默认为<code>key</code>字段）匹配的记录，并将 UID 传递给后续命令。例如：<code>/findentry file=chatLore field=key Shadowfang</code>。</li>
<li data-line="2" dir="auto"><code>/getentryfield file=bookName field=field [UID]</code> – 获取指定世界书文件中指定 UID 的记录的字段值（默认为<code>content</code>字段），并将其传递给后续命令。例如：<code>/getentryfield file={{getvar::chatLore}} field=content 123</code>。</li>
<li data-line="3" dir="auto"><code>/setentryfield file=bookName uid=UID field=field [text]</code> – 设置指定世界书文件中 UID（或指向 UID 的变量）记录的字段值（默认为<code>content</code>字段）。要为关键字段设置多个值，请使用逗号分隔的列表。例如：<code>/setentryfield file=chatLore uid=123 field=key Shadowfang,sword,weapon</code>。</li>
<li data-line="4" dir="auto"><code>/createentry file=bookName key=keyValue [content text]</code> – 在指定文件中创建一条新的记录，并传递 UID（<code>key</code>和<code>content</code>两个参数均为可选）。例如：<code>/createentry file=chatLore key=Shadowfang The sword of the king</code>。</li>
</ol></div><div class="el-h2"><h2 data-heading="有效字段" dir="auto" class="heading" id="有效字段_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>有效字段</h2></div><div class="el-table" dir="ltr" style="overflow-x: auto;"><table>
<thead>
<tr>
<th dir="ltr">字段</th>
<th dir="ltr">UI 元素</th>
<th dir="ltr">值类型</th>
</tr>
</thead>
<tbody>
<tr>
<td dir="ltr"><code>content</code></td>
<td dir="ltr">内容</td>
<td dir="ltr">字符串</td>
</tr>
<tr>
<td dir="ltr"><code>comment</code></td>
<td dir="ltr">标题/备注</td>
<td dir="ltr">字符串</td>
</tr>
<tr>
<td dir="ltr"><code>key</code></td>
<td dir="ltr">主要关键词</td>
<td dir="ltr">字符串列表</td>
</tr>
<tr>
<td dir="ltr"><code>keysecondary</code></td>
<td dir="ltr">可选过滤器</td>
<td dir="ltr">字符串列表</td>
</tr>
<tr>
<td dir="ltr"><code>constant</code></td>
<td dir="ltr">常量状态</td>
<td dir="ltr">布尔值（1/0）</td>
</tr>
<tr>
<td dir="ltr"><code>disable</code></td>
<td dir="ltr">禁用状态</td>
<td dir="ltr">布尔值（1/0）</td>
</tr>
<tr>
<td dir="ltr"><code>order</code></td>
<td dir="ltr">顺序</td>
<td dir="ltr">数字</td>
</tr>
<tr>
<td dir="ltr"><code>selectiveLogic</code></td>
<td dir="ltr">逻辑</td>
<td dir="ltr">（见下文）</td>
</tr>
<tr>
<td dir="ltr"><code>excludeRecursion</code></td>
<td dir="ltr">非递归</td>
<td dir="ltr">布尔值（1/0）</td>
</tr>
<tr>
<td dir="ltr"><code>probability</code></td>
<td dir="ltr">触发概率（%）</td>
<td dir="ltr">数字（0-100）</td>
</tr>
<tr>
<td dir="ltr"><code>depth</code></td>
<td dir="ltr">深度</td>
<td dir="ltr">数字（0-999）</td>
</tr>
<tr>
<td dir="ltr"><code>position</code></td>
<td dir="ltr">位置</td>
<td dir="ltr">（见下文）</td>
</tr>
<tr>
<td dir="ltr"><code>role</code></td>
<td dir="ltr">深度角色</td>
<td dir="ltr">（见下文）</td>
</tr>
<tr>
<td dir="ltr"><code>scanDepth</code></td>
<td dir="ltr">扫描深度</td>
<td dir="ltr">数字（0-100）</td>
</tr>
<tr>
<td dir="ltr"><code>caseSensitive</code></td>
<td dir="ltr">区分大小写</td>
<td dir="ltr">布尔值（1/0）</td>
</tr>
<tr>
<td dir="ltr"><code>matchWholeWords</code></td>
<td dir="ltr">完整词匹配</td>
<td dir="ltr">布尔值（1/0）</td>
</tr>
</tbody>
</table></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><strong>逻辑值</strong>
<ul class="has-list-bullet">
<li data-line="1" dir="auto"><span class="list-bullet"></span>0 = AND ANY（任何都满足）</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span>1 = NOT ALL（不是所有都满足）</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span>2 = NOT ANY（没有任何满足）</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>3 = AND ALL（所有都满足）</li>
</ul>
</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><strong>位置值</strong>
<ul class="has-list-bullet">
<li data-line="6" dir="auto"><span class="list-bullet"></span>0 = 主提示词之前</li>
<li data-line="7" dir="auto"><span class="list-bullet"></span>1 = 主提示词之后</li>
<li data-line="8" dir="auto"><span class="list-bullet"></span>2 = 作者注释顶部</li>
<li data-line="9" dir="auto"><span class="list-bullet"></span>3 = 作者注释底部</li>
<li data-line="10" dir="auto"><span class="list-bullet"></span>4 = 在聊天中按深度显示</li>
<li data-line="11" dir="auto"><span class="list-bullet"></span>5 = 示例消息顶部</li>
<li data-line="12" dir="auto"><span class="list-bullet"></span>6 = 示例消息底部</li>
</ul>
</li>
<li data-line="13" dir="auto"><span class="list-bullet"></span><span class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><strong>角色值</strong>（仅适用于位置 = 4）
<ul class="has-list-bullet">
<li data-line="14" dir="auto"><span class="list-bullet"></span>0 = 系统</li>
<li data-line="15" dir="auto"><span class="list-bullet"></span>1 = 用户</li>
<li data-line="16" dir="auto"><span class="list-bullet"></span>2 = 助手</li>
</ul>
</li>
</ul></div><div class="el-h2"><h2 data-heading="示例 1：根据关键字读取世界书条目内容" dir="auto" class="heading" id="示例_1：根据关键字读取世界书条目内容_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例 1：根据关键字读取世界书条目内容</h2></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/getchatbook | /setvar key=chatLore |
/findentry file={{getvar::chatLore}} field=key Shadowfang |
/getentryfield file={{getvar::chatLore}} field=key |
/echo
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="示例 2：使用关键字和内容创建世界书条目" dir="auto" class="heading" id="示例_2：使用关键字和内容创建世界书条目_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例 2：使用关键字和内容创建世界书条目</h2></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/getchatbook | /setvar key=chatLore |
/createentry file={{getvar::chatLore}} key="Milla" Milla Basset is a friend of Lilac and Carol. She is a hush basset puppy who possesses the power of alchemy. |
/echo
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h2"><h2 data-heading="示例 3：基于聊天记录扩展现有的世界书条目" dir="auto" class="heading" id="示例_3：基于聊天记录扩展现有的世界书条目_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>示例 3：基于聊天记录扩展现有的世界书条目</h2></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/getchatbook | /setvar key=chatLore |
/findentry file={{getvar::chatLore}} field=key Milla |
/setvar key=millaUid |
/getentryfield file={{getvar::chatLore}} field=content |
/setvar key=millaContent |
/gen lock=on Tell me more about Milla Basset based on the provided conversation history. Incorporate existing information into your reply: {{getvar::millaContent}} |
/setvar key=millaContent |
/echo New content: {{pipe}} |
/setentryfield file={{getvar::chatLore}} uid=millaUid field=content {{getvar::millaContent}}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h1"><h1 data-heading="文本处理" dir="auto" class="heading" id="文本处理_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>文本处理</h1></div><div class="el-p"><p dir="auto">有一系列有用的文本处理工具命令，可以在各种脚本场景中使用。</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>/trimtokens</code> — 将输入文本修剪至指定数量的文本标记，从开头或结尾修剪，并将结果传递给后续命令。</li>
<li data-line="1" dir="auto"><code>/trimstart</code> — 将输入文本修剪至第一个完整句子的开始部分，并将结果传递给后续命令。</li>
<li data-line="2" dir="auto"><code>/trimend</code> — 将输入文本修剪至最后一个完整句子的结束部分，并将结果传递给后续命令。</li>
<li data-line="3" dir="auto"><code>/fuzzy</code> — 执行模糊匹配，将输入文本与一组字符串进行匹配，并将最佳匹配项传递给后续命令。</li>
<li data-line="4" dir="auto"><code>/regex name=scriptName [text]</code> — 执行正则表达式脚本，处理指定的文本。该脚本必须已启用。</li>
</ol></div><div class="el-h2"><h2 data-heading="`/trimtokens` 的参数" dir="auto" class="heading" id="`/trimtokens`_的参数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><code>/trimtokens</code> 的参数</h2></div><div class="el-pre"><pre class="language-plain" tabindex="0"><code data-line="0" class="language-plain is-loaded">/trimtokens limit=number direction=start/end (input)
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>direction</code> 设置修剪方向，可以是 <code>start</code> 或 <code>end</code>。默认值为 <code>end</code>。</li>
<li data-line="1" dir="auto"><code>limit</code> 设置保留的文本标记数。也可以指定包含数量的变量名。<strong>必填参数。</strong></li>
<li data-line="2" dir="auto">未命名参数是要修剪的输入文本。</li>
</ol></div><div class="el-h2"><h2 data-heading="`/fuzzy` 的参数" dir="auto" class="heading" id="`/fuzzy`_的参数_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span><code>/fuzzy</code> 的参数</h2></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div class="footer"><div class="data-bar"></div></div></div></div></div><div id="right-content" class="leaf" style="--sidebar-width: var(--sidebar-width-right);"><div id="right-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme-toggle-input" id=""><input class="theme-toggle-input" type="checkbox" id="theme-toggle-input"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="right-sidebar-content" class="leaf-content"><div class="graph-view-wrapper"><div class="feature-header"><div class="feature-title">Interactive Graph</div></div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<div class="graph-icon graph-global" role="button" aria-label="Global Graph" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-git-fork"><circle cx="12" cy="18" r="3"></circle><circle cx="6" cy="6" r="3"></circle><circle cx="18" cy="6" r="3"></circle><path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9"></path><path d="M12 12v3"></path></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div id="outline" class=" tree-container"><div class="feature-header"><div class="feature-title">Table Of Contents</div><button class="clickable-icon nav-action-button tree-collapse-all" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-item" data-depth="1"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#4.1_STscript_语言参考_0" data-path="#4.1_STscript_语言参考_0"><div class="tree-item-inner heading-link" heading-name="4.1 STscript 语言参考">4.1 STscript 语言参考</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#STscript_语言参考_0" data-path="#STscript_语言参考_0"><div class="tree-item-inner heading-link" heading-name="STscript 语言参考">STscript 语言参考</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#什么是_STscript？_0" data-path="#什么是_STscript？_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="什么是 STscript？">什么是 STscript？</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#安全预防_0" data-path="#安全预防_0"><div class="tree-item-inner heading-link" heading-name="安全预防">安全预防</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#Hello,_World!_0" data-path="#Hello,_World!_0"><div class="tree-item-inner heading-link" heading-name="Hello, World!">Hello, World!</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#用户输入_0" data-path="#用户输入_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="用户输入">用户输入</div></a><div class="tree-item-children"><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#其他输入/输出命令_0" data-path="#其他输入/输出命令_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="其他输入/输出命令">其他输入/输出命令</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#`/popup`_和_`/input`_的额外参数_0" data-path="#`/popup`_和_`/input`_的额外参数_0"><div class="tree-item-inner heading-link" heading-name="`/popup` 和 `/input` 的额外参数"><code>/popup</code> 和 <code>/input</code> 的额外参数</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#`/echo`_的参数_0" data-path="#`/echo`_的参数_0"><div class="tree-item-inner heading-link" heading-name="`/echo` 的参数"><code>/echo</code> 的参数</div></a><div class="tree-item-children"></div></div></div></div></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#变量_0" data-path="#变量_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="变量">变量</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#数组和对象_0" data-path="#数组和对象_0"><div class="tree-item-inner heading-link" heading-name="数组和对象">数组和对象</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#流程控制_-_条件语句_0" data-path="#流程控制_-_条件语句_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="流程控制 - 条件语句">流程控制 - 条件语句</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#`/if`_参数_0" data-path="#`/if`_参数_0"><div class="tree-item-inner heading-link" heading-name="`/if` 参数"><code>/if</code> 参数</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#布尔运算_0" data-path="#布尔运算_0"><div class="tree-item-inner heading-link" heading-name="布尔运算">布尔运算</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#子命令_0" data-path="#子命令_0"><div class="tree-item-inner heading-link" heading-name="子命令">子命令</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#转义序列_0" data-path="#转义序列_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="转义序列">转义序列</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#宏_0" data-path="#宏_0"><div class="tree-item-inner heading-link" heading-name="宏">宏</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#管道符_0" data-path="#管道符_0"><div class="tree-item-inner heading-link" heading-name="管道符">管道符</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#引号_0" data-path="#引号_0"><div class="tree-item-inner heading-link" heading-name="引号">引号</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#空格_0" data-path="#空格_0"><div class="tree-item-inner heading-link" heading-name="空格">空格</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#闭包定界符_0" data-path="#闭包定界符_0"><div class="tree-item-inner heading-link" heading-name="闭包定界符">闭包定界符</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#管道断开符_0" data-path="#管道断开符_0"><div class="tree-item-inner heading-link" heading-name="管道断开符">管道断开符</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#闭包_0" data-path="#闭包_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="闭包">闭包</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#子命令_1" data-path="#子命令_1"><div class="tree-item-inner heading-link" heading-name="子命令">子命令</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#作用域_0" data-path="#作用域_0"><div class="tree-item-inner heading-link" heading-name="作用域">作用域</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#命名闭包_0" data-path="#命名闭包_0"><div class="tree-item-inner heading-link" heading-name="命名闭包">命名闭包</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#闭包参数_0" data-path="#闭包参数_0"><div class="tree-item-inner heading-link" heading-name="闭包参数">闭包参数</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#闭包和管道参数_0" data-path="#闭包和管道参数_0"><div class="tree-item-inner heading-link" heading-name="闭包和管道参数">闭包和管道参数</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#立即执行闭包_0" data-path="#立即执行闭包_0"><div class="tree-item-inner heading-link" heading-name="立即执行闭包">立即执行闭包</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#注释_0" data-path="#注释_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="注释">注释</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#块注释_0" data-path="#块注释_0"><div class="tree-item-inner heading-link" heading-name="块注释">块注释</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#流程控制_0" data-path="#流程控制_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="流程控制">流程控制</div></a><div class="tree-item-children"><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#循环：`/while`_和_`/times`_0" data-path="#循环：`/while`_和_`/times`_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="循环：`/while` 和 `/times`">循环：<code>/while</code> 和 <code>/times</code></div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#`/while`_的参数_0" data-path="#`/while`_的参数_0"><div class="tree-item-inner heading-link" heading-name="`/while` 的参数"><code>/while</code> 的参数</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#`/times`_的参数_0" data-path="#`/times`_的参数_0"><div class="tree-item-inner heading-link" heading-name="`/times` 的参数"><code>/times</code> 的参数</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#跳出循环和闭包_0" data-path="#跳出循环和闭包_0"><div class="tree-item-inner heading-link" heading-name="跳出循环和闭包">跳出循环和闭包</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#数学运算_0" data-path="#数学运算_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="数学运算">数学运算</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#示例_1：计算半径为_50_的圆的面积。_0" data-path="#示例_1：计算半径为_50_的圆的面积。_0"><div class="tree-item-inner heading-link" heading-name="示例 1：计算半径为 50 的圆的面积。">示例 1：计算半径为 50 的圆的面积。</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#示例_2：计算_5_的阶乘。_0" data-path="#示例_2：计算_5_的阶乘。_0"><div class="tree-item-inner heading-link" heading-name="示例 2：计算 5 的阶乘。">示例 2：计算 5 的阶乘。</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#使用_LLM（大语言模型）_0" data-path="#使用_LLM（大语言模型）_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="使用 LLM（大语言模型）">使用 LLM（大语言模型）</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#`/gen`_和_`/genraw`_的参数_0" data-path="#`/gen`_和_`/genraw`_的参数_0"><div class="tree-item-inner heading-link" heading-name="`/gen` 和 `/genraw` 的参数"><code>/gen</code> 和 <code>/genraw</code> 的参数</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#提示词注入_0" data-path="#提示词注入_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="提示词注入">提示词注入</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#`/inject`_的参数_0" data-path="#`/inject`_的参数_0"><div class="tree-item-inner heading-link" heading-name="`/inject` 的参数"><code>/inject</code> 的参数</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#访问聊天消息_0" data-path="#访问聊天消息_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="访问聊天消息">访问聊天消息</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#读取消息_0" data-path="#读取消息_0"><div class="tree-item-inner heading-link" heading-name="读取消息">读取消息</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#发送消息_0" data-path="#发送消息_0"><div class="tree-item-inner heading-link" heading-name="发送消息">发送消息</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#删除消息_0" data-path="#删除消息_0"><div class="tree-item-inner heading-link" heading-name="删除消息">删除消息</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#世界书（World_Info）命令_0" data-path="#世界书（World_Info）命令_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="世界书（World Info）命令">世界书（World Info）命令</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#有效字段_0" data-path="#有效字段_0"><div class="tree-item-inner heading-link" heading-name="有效字段">有效字段</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#示例_1：根据关键字读取世界书条目内容_0" data-path="#示例_1：根据关键字读取世界书条目内容_0"><div class="tree-item-inner heading-link" heading-name="示例 1：根据关键字读取世界书条目内容">示例 1：根据关键字读取世界书条目内容</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#示例_2：使用关键字和内容创建世界书条目_0" data-path="#示例_2：使用关键字和内容创建世界书条目_0"><div class="tree-item-inner heading-link" heading-name="示例 2：使用关键字和内容创建世界书条目">示例 2：使用关键字和内容创建世界书条目</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#示例_3：基于聊天记录扩展现有的世界书条目_0" data-path="#示例_3：基于聊天记录扩展现有的世界书条目_0"><div class="tree-item-inner heading-link" heading-name="示例 3：基于聊天记录扩展现有的世界书条目">示例 3：基于聊天记录扩展现有的世界书条目</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#文本处理_0" data-path="#文本处理_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="文本处理">文本处理</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#`/trimtokens`_的参数_0" data-path="#`/trimtokens`_的参数_0"><div class="tree-item-inner heading-link" heading-name="`/trimtokens` 的参数"><code>/trimtokens</code> 的参数</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="sillytavern/4-开发与自动化/4.1-stscript-语言参考.html#`/fuzzy`_的参数_0" data-path="#`/fuzzy`_的参数_0"><div class="tree-item-inner heading-link" heading-name="`/fuzzy` 的参数"><code>/fuzzy</code> 的参数</div></a><div class="tree-item-children"></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector("#right-sidebar"); rs.classList.toggle("is-collapsed", window.innerWidth < 768); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></div></body></html>